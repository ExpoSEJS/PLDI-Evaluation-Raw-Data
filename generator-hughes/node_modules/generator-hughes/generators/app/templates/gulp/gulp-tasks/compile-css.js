var gulp = require('gulp'),
		postcss = require('gulp-postcss'),
		cssmin = require('gulp-cssmin'),
		rename = require("gulp-rename"),
		autoprefixer = require('autoprefixer'),
 		wp_themes_dir = '<%= buildDir %>/<%= wpContentDir %>/themes',
 		theme_dir = '<%= themeDirName %>',
		
		globalDest = wp_themes_dir + '/' + theme_dir + '/css/',
		componentDest = wp_themes_dir + '/' + theme_dir + '/css/components';



var processors = [
	  require('postcss-import'),
		require("postcss-cssnext"),
		// require('autoprefixer')({ browsers: ['last 3 versions'] }),
		require('postcss-color-gray'),
		require("postcss-custom-media"),
		require("postcss-custom-properties"),
		require('postcss-custom-selectors'),
		require('postcss-mixins'),
		require('lost'),
		require("postcss-calc"),
		require('postcss-nested')
	]

gulp.task('styles', ['globalStyles', 'components'] )

gulp.task('components', function() {
	return gulp.src('src/css/components/**/*.css')
	// .pipe(newer(componentDest))
    .pipe(postcss( processors ))
	.pipe(gulp.dest( componentDest ))
    .pipe(cssmin())
	.pipe(rename({ suffix: '.min' }))
	.pipe(gulp.dest( componentDest ))
  });
  
gulp.task('globalStyles', function() {
		
	return gulp.src('src/css/global.css')
	// .pipe(newer(globalDest))
    .pipe(postcss( processors ))
	.pipe(gulp.dest( globalDest ))
    .pipe(cssmin())
	  .pipe(rename({ suffix: '.min' }))
		.pipe(gulp.dest( globalDest ))
			
  });


// var gulp = require('gulp'),
// 		postcss = require('gulp-postcss'),
// 		cssmin = require('gulp-cssmin'),
// 		rename = require("gulp-rename"),
// 		autoprefixer = require('autoprefixer'),
// 		wp_themes_dir = '<%= buildDir %>/<%= wpContentDir %>/themes',
// 		theme_dir = '<%= themeDirName %>';

// gulp.task('styles', function() {
// 		var processors = [
// 				require("postcss-cssnext"),
// 				require('autoprefixer')({ browsers: ['last 2 versions'] }),
// 			  require('postcss-import')({path: ['bower_components'], from: 'src/css/style.css'}),
// 				require('postcss-color-gray'),
// 				require("postcss-custom-media"),
// 				require("postcss-custom-properties"),
// 				require('postcss-custom-selectors'),
// 				require("postcss-calc"),
//         require('postcss-mixins'),
// 			  require('postcss-neat')({
// 					neatMaxWidth: '85em'
// 				}),
// 			  require('postcss-nested'),
// 			  require('postcss-object-fit-images')
// 		]
		
//     return gulp.src('<%= srcDir %>/css/style-map.css')
//       .pipe(postcss( processors ))
//       //.pipe(newer(theme.themesdir.dirname+'/css/'))
//       .pipe(rename({basename: 'style'}))
//       .pipe(gulp.dest( wp_themes_dir + '/' + theme_dir + '/css/'))
      
//       .pipe(cssmin())
// 		  .pipe(rename({ 
// 		  	basename: 'style',
// 		  	suffix: '.min' 
		  	
// 		  }))
// 			.pipe(gulp.dest( wp_themes_dir + '/' + theme_dir + '/css/'))
			
//   });