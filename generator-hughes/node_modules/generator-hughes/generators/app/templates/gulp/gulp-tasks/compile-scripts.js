var gulp = require('gulp'),
	newer = require('gulp-newer'),
	uglify = require('gulp-uglify'),
	concat = require('gulp-concat'),
	rename = require('gulp-rename'),
	browserify = require("browserify"),
	source = require('vinyl-source-stream'),
	wp_themes_dir = '<%= buildDir %>/<%= wpContentDir %>/themes',
	theme_dir = '<%= themeDirName %>',
	dest = wp_themes_dir + '/' + theme_dir + '/js';

gulp.task('scripts', [
    // Global
    'globalScripts',
    
    // API
    'wp-api',
    
    // Components
    'components'
    ], function() {
});

gulp.task('globalScripts', function() {
	return gulp.src([
		'node_modules/smoothscroll-for-websites/SmoothScroll.js',
		'node_modules/object-fit-images/dist/ofi.browser.js',
		])
		.pipe(concat('globalScripts.js'))
		.pipe(newer( dest))
		.pipe(gulp.dest( dest))
		.pipe(rename('globalScripts.min.js'))
		.pipe(uglify())
		.pipe(newer( dest))
		.pipe(gulp.dest( dest))
});

// API
gulp.task('wp-api', function() {
	return browserify({entries: [
		'src/js/wordpress-api.js'
		]})
		.transform("babelify")
		.bundle()
		.pipe(source('wordpress-api.js'))
		.pipe(gulp.dest( dest ))
});

// Components

gulp.task('components', function() {
	return browserify({entries: [
		'src/js/slider.js'
		]})
		.transform("babelify")
		.bundle()
		.pipe(source('scripts.js'))
		.pipe(gulp.dest( dest ))
});