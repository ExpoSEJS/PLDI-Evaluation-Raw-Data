/*!
* Ourjs.com
* Copyright Kris Zhang (kris.newghost@gmail.com)
*/
String.prototype.format=function(){for(var c=this,d=0;d<arguments.length;++d){c=c.replace(new RegExp("\\{"+d+"\\}","g"),arguments[d])}return c};(function(a){a.fn.toJSON=function(){var c={};var b=this.serializeArray();a.each(b,function(){if(c[this.name]!==undefined){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}});return c}})(jQuery);var OurJS=window.OurJS||{};var conf=conf||{};(function(){OurJS.navi=function(){var b=conf.category;$("ul.nav li>a").each(function(){var c=$(this);if(c.attr("href").indexOf(b)>-1){c.closest("li").addClass("active");return}});var a=$(".nav>li").click(function(f){var d=$(this),c=$("#about");a.removeClass("active");d.addClass("active");$(f.target).attr("id")=="aboutlink"?c.slideDown():c.slideUp()})};OurJS.navi()})();(function(){OurJS.subscribe=function(){$("#recommendbtn").click(function(){var b=$("#recommendfm"),c=b.toJSON();if(c.email==""||c.user==""||c.content==""){return}$("#recommendfm")[0].reset();$.post("/jd/new",c,function(d){if(d){b.hide("slow");$("#jd_info").attr("href","/jd_info/"+d);$("#recommend_result").show()}})});var a=$("#subscribe").submit(function(c){var b=$("#to").val();if(!b){c.preventDefault();return false}$.post("/subscribe.post",JSON.stringify({email:b}),function(){a[0].reset()}).fail(function(){})})};OurJS.subscribe()})();(function(){OurJS.loadMore=function(){var b=$("#articles"),a=$("#loader"),e=$("#loadmore");var d=function(f){f.find("a.btn").each(function(){var h=$(this),g=h.closest(".span4").find("h2"),i=g.text();g.html($('<a target="_blank" href="{1}">{0}</a>'.format(i,h.attr("href"))))});return f};var c=function(i){i&&i.preventDefault&&i.preventDefault();if(e.attr("disabled")){return}e.attr("disabled",true);a.show();var g=conf.pageSize||12,h=$("#articles .span4").size(),f=h/g|0;$.getJSON("/json/"+conf.category+"/"+f,function(m){var j=m.length,l="";for(var k=0;k<j;k++){var o=m[k];k%3==0&&(l+='<div class="row-fluid">');var n=o.content?'<p><a target="_blank" class="btn" href="/detail/{0}">查看详细 &raquo;</a></p>'.format(o._id):'<p><a target="_blank" class="btn" href="{0}">打开链接 &raquo;</a></p>'.format(o.url);l+='<div class="span4"><h2>'+o.title+'</h2><p class="note">'+'<a target="_blank" href="/home/{0}">{1}</a>'.format(o.category,o.categoryName)+' By <a class="author">{0}</a> '.format(o.author)+o.postdate+"</p><div>"+o.summary+"</div>"+n+"</div>";(k-2)%3==0&&(l+="</div>")}e.attr("disabled",j<g);a.hide();b.append(d($(l)))})};$("#articles .span4").size()<conf.pageSize&&e.attr("disabled",true);e.click(c);if(b.size()&&a.size()){$(window).scroll(function(){if($(window).scrollTop()+$(window).height()==$(document).height()){c()}})}d($("#articles"))};OurJS.loadMore()})();(function(){OurJS.formatUrl=function(){var c=$("#originUrl");if(c.size()){var b=c.attr("href");b=b.replace("http://www.","");b=b.replace("http://","");b=b.replace("https://www.","");b=b.replace("https://","");var a=b.indexOf("/");a=a>0?a:b.length;c.text(b.substr(0,a))}};OurJS.formatUrl()})();(function(){OurJS.editor=function(){};OurJS.editor()})();