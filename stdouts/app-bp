/root/Targets/app-bp
└── app-bp@0.0.12 

Setup Done exists, not setting up
:../FeatureTester/libs/:/root/Targets/app-bp/node_modules
Set Default Z3_PATH to ./node_modules/z3javascript/bin/libz3.so
ExpoSE Master: /root/ExpoSE/lib/Harness/src/harness.js max concurrent: 16 max paths: 1000000
Setting timeout to 900000
*** [0 done /0 queued / 1 running / 0 errors / 0% coverage ] ****** [0 done /0 queued / 1 running / 0 errors / 0% coverage ] ****** [1 done /0 queued / 0 running / 1 errors / 32% coverage ] ***
*-- Stat Module Output --*
*-- concretizations: ["defineProperty","bound log"]
*-- Stat Module Done --*
*-- Test Case {"_bound":0} start 0.0621 took 2.8998s
*-- Errors occured in test {"_bound":0}
* Error: Tropigate failed because SyntaxError: Binding arguments in strict mode (271:20) on program var http = require("http");
var url = require("url");
var connect = require("connect");

var Router = require('barista').Router;
var router = new Router;
var Db = require('mongodb').Db;
var Server = require('mongodb').Server;
var SessionDiskStore = require('./SessionDiskStore');


require("jinjs").registerExtension(".jinja2");

var controllers;
var selectedDbName;
exports.useDb = function (dbName) {
    selectedDbName = dbName;
};

var fs = require('fs');
var path = require('path');
readFileSync = fs.readFileSync;
var baseViewFolder=__dirname;

function requireView(viewName) {
    console.log("Requiring view "+viewName);

    var customPath = path.join(baseViewFolder ,path.join("../../../../server/view/",viewName));
    if (fs.existsSync(customPath+".jinja2")){
        console.log("Requiring custom view "+path.join("../../../../server/view/",viewName));
        return require(path.join("../../../../server/view/",viewName));
    } else{
        console.log("Requiring standard view "+path.join("./view/",viewName));
        return require("./"+path.join("view",viewName));
    }


}

function view_path(viewName){
    var customPath = path.join(process.cwd(),path.join("./view/",viewName));
    if (fs.existsSync(customPath+".jinja2")){
        console.log("Requiring custom view "+path.join("../../../../server/view/",viewName));
        return require(customPath);
    } else{
        console.log("Requiring standard view "+path.join("./view/",viewName));
        return require(path.join(baseViewFolder,"view/"+viewName));
    }

}


exports.runControllers = function (ctrls) {
    controllers = ctrls;
    controllers.auth = require("./auth");
    var app = connect()
        /*.use(connect.bodyParser())
        .use(connect.query())
        .use(connect.logger('dev'))
        .use(connect.cookieParser())
        .use(connect.session({ secret:conf.server.cookieSecret, store:new SessionDiskStore() }))
        .use(route)
        .use(connect.favicon())
        .use(connect.static('../client'))
        .use(connect.static('../node_modules/app-bp/lib/client'))
        .use(connect.static('../node_modules/app-bp/node_modules/html5-boilerplate-npm'))
        .use(connect.static('../node_modules/app-bp/node_modules/bootstrap-npm'))

        .use(notFound);*/
        .use(connect.favicon())
        .use(connect.bodyParser())
        .use(connect.query())
        .use(connect.logger('dev'))
        .use(connect.static('../client'))
        .use(connect.static('../node_modules/app-bp/lib/client'))
        .use(connect.static('../node_modules/app-bp/node_modules/html5-boilerplate-npm'))
        .use(connect.static('../node_modules/app-bp/node_modules/bootstrap-npm'))
        .use(connect.cookieParser())
        .use(connect.session({ secret:conf.server.cookieSecret, store:new SessionDiskStore() }))
        .use(route)
        .use(notFound);
    http.createServer(app).listen(conf.server.port);
    console.log("Server has started on port "+conf.server.port);


    for (var ctrl2 in controllers) {
        if (controllers.hasOwnProperty(ctrl2)) {
            setup_routes("", controllers[ctrl2], router)
        }
    }

    for (var ctrl in controllers) {
        if (controllers.hasOwnProperty(ctrl)) {
            var onAppStart = controllers[ctrl].onAppStart;
            if (onAppStart) {
                var context = new Context(null, null, null);
                onAppStart.apply(context, context.args);

            }
        }
    }
};


function setup_routes(prefix, ctrl, router) {
    var Get = function (url, target) {
        return router.get(url).to(target)
    };
    var Post = function (url, target) {
        return router.post(url).to(target)
    };
    var Put = function (url, target) {
        return router.put(url).to(target)
    };
    var Del = function (url, target) {
        return router.del(url).to(target)
    };


    function add_routes(routes, addRoute) {
        if (routes) {
            for (var url in routes) {
                if (routes.hasOwnProperty(url)) {
                    addRoute(prefix + url, routes[url]);

                }
            }
        }

    }

    if (!ctrl.name){
        throw new Error("Please define name in controllers. E.g.:exports.name='index';");

    }

    if (!ctrl.routes){
        throw new Error("Please define routes in controller "+ctrl.name+". E.g.:exports.routes={get:{'/index':'posts.index@jinja:index'}};");

    }
    add_routes(ctrl.routes.get, Get);
    add_routes(ctrl.routes.post, Post);
    add_routes(ctrl.routes.del, Del);
    add_routes(ctrl.routes.put, Put);
}

function Context(request, response, routed) {
    this.app=app;
    this.request = request;
    this.response = response;
    if (request != null)
        this.current = url.parse(request.url).pathname;

    var args = [];
    this.namedArgs = {};
    if (routed != null) {
        for (var name in routed) {
            if (routed.hasOwnProperty(name) && "controller,action,method".indexOf(name) == -1) {
                args.push(routed[name]);
                this.namedArgs[name] = routed[name];
            }
        }

    }
    this.args = args;

    return this;
}
Context.prototype.createMongoClient = function () {
    return new Db(selectedDbName, new Server(app.config.mongo.host, app.config.mongo.port, {}), {w:1});
};

var onCollection=Context.prototype.onCollection = function (collection, callback) {
    var client = this.createMongoClient();
    if (this.response) {
        this.response.on('finish', function () {
            client.close();
        });
    }

    client.open(function (err, p_client) {
        if (err)
            throw new Error(err);
        else
            client.collection(collection, function (err, collection) {
                if (err)
                    throw new Error(err);
                else
                    callback(client, collection, client);
            });
    });
};


function action(caption, image, onclick) {
    return '<li><a onclick="' + onclick + '">' +
        '<i class="icon-' + image + '"></i> ' + caption + '</a></li>';
}



function renderTemplate(context, response, controller, viewName, controllerResults) {
    var path = require('path');
    var toDelete = [];
    var suffix = ".jinja2";
    for (var key in require.cache)
        if (require.cache.hasOwnProperty(key) && key.indexOf(suffix, this.length - suffix.length) !== -1)
            toDelete.push(key);

    toDelete.forEach(function (key) {
            delete require.cache[key]
        }
    );
    //toDelete.forEach(function(key){console.log(key)});

    var template = requireView(viewName);
    return template.render({
        view_path:view_path,
        context:context,
        results:controllerResults
    });
}

function getStackTrace(err) {

    return err.stack;
}


function getParamNames(func) {
    var funStr = func.toString();
    return funStr.slice(funStr.indexOf('(') + 1, funStr.indexOf(')')).match(/([^\s,]+)/g);
}

function route(request, response,next) {
    var pathname = url.parse(request.url).pathname;
    var routed = router.first(pathname, request.method);
    var context = new Context(request, response, routed);

    if (routed) {
        var dest = routed.action.split("@");

        var controller = controllers[routed.controller];
        var controllerAction = controller && controller[dest[0]];
        var view = dest[1];

        if (!controller){
            throw new Error("Server controller not found:"+routed.controller);
        }
        if (!controllerAction){
            throw new Error("Server controller action not found:"+routed.action);
        }
        if (!view){
            throw new Error("Server view not found:"+routed.action);
        }
        function renderErrTemplate(statusCode, viewName2, args) {
            try {
                var resultErr = renderTemplate(context, response, controller, viewName2, args);
                response.writeHead(statusCode, {"Content-Type":"text/html"});
                response.end(resultErr);
            } catch (err) {
                response.end("An arror has occurred during page generation.\r\n\r\nerror message:\r\n" + err);
            }


        }

        function executeController() {
            try {
                var args = [];
                var arguments = getParamNames(controllerAction);
                if (arguments)
                    for (var arg=0;arg<arguments.length;arg++) {
                        if (context.namedArgs.hasOwnProperty(arguments[arg])) {
                            args.push(context.namedArgs[arguments[arg]]);
                        }
                    }

                controllerAction.apply(context, args);
            } catch (err) {

                context.onError(err, getStackTrace(err));

            }
        }

        function render(controllerResults, onEnd) {

            var viewName = controller.name + "/" + view.replace("jinja:", "");
            var result = renderTemplate(context, response, controller, viewName, controllerResults);
            response.writeHead(200, {"Content-Type":"text/html"});
            response.end(result);
            if (onEnd)
                onEnd();

        }

        render.onError = function (err, stacktrace) {


            var args = {
                err:{
                    message:err.toString().replace("<", "&lt;"),
                    stacktrace:stacktrace.toString().replace("<", "&lt;").replace(/\n/g, "<br/>\n")
                }
            };
            console.log(err);
            console.log(stacktrace);

            renderErrTemplate(500, "error", args);
        };
        function renderJson(controllerResults, onEnd) {
            response.writeHead(200, {"Content-Type":"application/json"});

            response.end(JSON.stringify(controllerResults));
            if (onEnd)
                onEnd();

        }

        renderJson.onError = function (err, stacktrace) {
            try {
                response.writeHead(500, {"Content-Type":"application/json"});
            } catch (e) {
            }
            var args = {
                status:"error",
                error:{
                    message:err.toString().replace("<", "&lt;"),
                    stacktrace:stacktrace.toString().replace("<", "&lt;")
                }
            };
            console.log(err);
            console.log(stacktrace);
            response.end(JSON.stringify(args));
        };
        context.redirect = function (url) {
            response.writeHead(303, {
                "Content-Type":"text/html",
                'Location':url
            });

            response.end("This page has moved to:" + url);
        };
        context.unauthorized = function () {
            response.writeHead(401, {
                "Content-Type":"text/html"

            });

            response.end("You are not authorized to use this resource");
        };

        var renderer;
        if (dest[1].indexOf("jinja:") == 0) {
            renderer = render;
        } else
            renderer = renderJson;

        function executeRenderer(controllerResults) {
            try {
                renderer(controllerResults);
            } catch (err) {
                renderer.onError(err, getStackTrace(err));

            }
        }

        process.on('uncaughtException', function (err) {
            context.onError(err, getStackTrace(err));
        });
        context.renderer = executeRenderer;
        context.onError = renderer.onError;
        executeController();

    } else {
        next();

    }


}
function notFound(request, response,next) {
    var pathname = url.parse(request.url).pathname;
    var context = new Context(request, response, null);

    function renderErrTemplate(statusCode, viewName2, args) {
        try {
            var resultErr = renderTemplate(context, response, null, viewName2, args);
            response.writeHead(statusCode, {"Content-Type":"text/html"});
            response.end(resultErr);
        } catch (err) {
            response.end("An arror has occurred during page generation.\r\n\r\nerror message:\r\n" + err);
        }


    }
    renderErrTemplate(404, "notfound", {
        url:pathname.replace("<", "&lt;")
    });
}

var app=exports.app={
    onCollection:onCollection
};
var conf = new (require("./conf").Conf)();
app.config=conf.load().server;
 at SyntaxError: Binding arguments in strict mode (271:20)
    at Parser.pp$4.raise (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2221:15)
    at Parser.pp$2.checkLVal (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:1472:14)
    at Parser.pp$1.parseVarId (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:1050:10)
    at Parser.pp$1.parseVar (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:1032:14)
    at Parser.pp$1.parseVarStatement (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:917:10)
    at Parser.pp$1.parseStatement (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:706:19)
    at Parser.parseStatement (/root/ExpoSE/lib/Tropigate/bin/Statements.js:104:30)
    at Parser.pp$1.parseBlock (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:981:25)
    at Parser.pp$1.parseTryStatement (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:897:23)
    at Parser.pp$1.parseStatement (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:702:31)
*-- Replay with NO_COMPILE=1 expoSE replay '/root/ExpoSE/lib/Harness/src/harness.js' '{"_bound":0}'
*-- Coverage Data
*- File /root/ExpoSE/lib/Harness/src/harness.js. Coverage (Term): 18% Coverage (LOC): 24%
*- File /root/ExpoSE/lib/S$/bin/symbols.js. Coverage (Term): 16% Coverage (LOC): 34%
*- File /root/Targets/app-bp/node_modules/app-bp/index.js. Coverage (Term): 16% Coverage (LOC): 24%
*- Re-run with EXPOSE_PRINT_COVERAGE=1 to print line by line coverage information
** ExpoSE Finished. 1 paths with 1 errors **
