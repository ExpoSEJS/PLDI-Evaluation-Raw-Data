- amdefine@1.0.1 node_modules/amdefine
- assert-plus@1.0.0 node_modules/dashdash/node_modules/assert-plus
- assert-plus@1.0.0 node_modules/getpass/node_modules/assert-plus
- assert-plus@1.0.0 node_modules/jsprim/node_modules/assert-plus
- assert-plus@1.0.0 node_modules/sshpk/node_modules/assert-plus
- assert-plus@1.0.0 node_modules/verror/node_modules/assert-plus
/root/Targets/kostal
└─┬ kostal@1.2.2 
  ├─┬ jsdom@11.3.0 
  │ ├── abab@1.0.4 
  │ ├── acorn@5.1.2 
  │ ├── acorn-globals@4.0.0 
  │ ├── domexception@1.0.0 
  │ ├─┬ escodegen@1.9.0 
  │ │ ├── esprima@3.1.3 
  │ │ ├── estraverse@4.2.0 
  │ │ └── source-map@0.5.7 
  │ ├── nwmatcher@1.4.2 
  │ ├── request-promise-native@1.0.5 
  │ ├── tough-cookie@2.3.3 
  │ └─┬ whatwg-url@6.3.0 
  │   └─┬ tr46@1.0.1 
  │     └── punycode@2.1.0 
  └─┬ request@2.83.0 
    ├── aws-sign2@0.7.0 
    ├── form-data@2.3.1 
    ├─┬ har-validator@5.0.3 
    │ ├─┬ ajv@5.2.3 
    │ │ ├── fast-deep-equal@1.0.0 
    │ │ └── json-schema-traverse@0.3.1 
    │ └── har-schema@2.0.0 
    ├─┬ hawk@6.0.2 
    │ ├── boom@4.3.1 
    │ ├─┬ cryptiles@3.1.2 
    │ │ └── boom@5.2.0 
    │ ├── hoek@4.2.0 
    │ └── sntp@2.0.2 
    ├─┬ http-signature@1.2.0 
    │ └── assert-plus@1.0.0 
    ├── performance-now@2.1.0 
    └── qs@6.5.1 

Setup Done exists, not setting up
:../FeatureTester/libs/:/root/Targets/kostal/node_modules
Set Default Z3_PATH to ./node_modules/z3javascript/bin/libz3.so
ExpoSE Master: /root/ExpoSE/lib/Harness/src/harness.js max concurrent: 16 max paths: 1000000
Setting timeout to 900000
*** [0 done /0 queued / 1 running / 0 errors / 0% coverage ] ****** [0 done /0 queued / 1 running / 0 errors / 0% coverage ] ****** [1 done /0 queued / 0 running / 1 errors / 33% coverage ] ***
*-- Stat Module Output --*
*-- concretizations: ["defineProperty","bound log"]
*-- Stat Module Done --*
*-- Test Case {"_bound":0} start 0.0554 took 3.9572s
*-- Errors occured in test {"_bound":0}
* Error: Tropigate failed because SyntaxError: Octal literal in strict mode (106:39) on program var options = {}, options_default = {
  url: "",
  interval: 60,
  sep: ';',
  dir:  'logs/', //use with trailing /
  onData: function(live){/*doSomething*/}
};

var request = require('request');
var jsdom = require('jsdom');
var fs = require('fs');
var mkdirp = require('mkdirp');
var extend = require('extend');

var excel = {
  header: "TimeISO;TimeExcel;E_Tot;E;P;U1;A1;U2;A2;U3;A3\n",
  map: [
	"P",
	"E_Tot",
	"E",
	"U1", false,
	"A1", false,
	"U2", false,
	"A2", false,
	"U3", false,
	"A3", false,false,false,false,false
 ],
 line: function excel_line(data){
    var sep = options.sep;
    var t = new Date();
    var line = '' +
        t.toISOString() + sep +
        this.time(t) + sep +
	     data.E_Tot + sep +
	     data.E + sep +
	     data.P + sep +
	     data.U1 + sep +
	     data.A1 + sep +
	     data.U2 + sep +
	     data.A2 + sep +
	     data.U3 + sep +
	     data.A3 + '\n';
    if (!data.P) {
      module.exports.stop(); //no data, so we will stop everything
      return;
    }
    this.write(line.replace(/\./g,',')); 
  },
  time: function excel_time(t){
    var ts = Math.round( t.getTime() / 1000);
    return ts/86400+25569; //Format with datetime to get date in libreoffice
  },
  write_nr: 0,
  write: function excel_write(line){
    var line = line || this.header;
    this.write_nr =+1;
    console.log(options.dir + options.filename);
    console.log(this.write_nr + ': ' +line);
    if (line !== this.header) options.onData({filename: options.filename, line: line});
    fs.appendFile(options.dir + options.filename, line, function (err) {
      if (err) throw err;
    });
  }
};


function poll(){
	request.get(options.url, function (error, response, body) {
	  if (!error && response.statusCode == 200) {
	    //console.log(body);
	    jsdom.env({
	      html: body,
	      scripts: [ 'jquery.js' ],
	      done: function(err, window){
	        var $ = window.$;
	        var data = {};
	        if (err) {console.log('Uhhh we had an error: ' + err);}
	        $('td[bgcolor=#FFFFFF]').each(function(key, val) {
	        	var val = parseFloat($(val).text().trim()),
	        	    key = excel.map[key];
	        	if (key) data[key] = val?val:'';
	        });
	        excel.line(data);
	        window.close();
	      }
	    });
	  }
	});
};

function getFileName(pre){
  pre = pre || 'kostal';
  var d = new Date();
  var date = d.getFullYear()*10000 + (d.getMonth()+1) * 100 + d.getDate();
  var time = d.getHours()*100+d.getMinutes();
  return pre + "_" + date + "_" + ((time<1000)?"0":"") + time + ".dat";
}


module.exports={
  start: function (opts) {
    extend(options, options_default, opts);
    if (!options.url) {throw new Error("Hey! Provide me with an url!");}
    options.filename = getFileName();
  	
    console.log('STARTING to poll from \033[36m' + options.url +
                '\033[39m every \033[36m' + options.interval + 's ' +
                '\033[39m and writing to \033[36m' + options.dir + options.filename +
                '\033[39m!');
    mkdirp(options.dir, function(err) { //make sure the logging dir exists
      excel.write(); // w/o argruments prints header
      poll();
      options.interval_handler = setInterval(poll, options.interval * 1000);
    });
  
  },
  stop: function(){
    if (options.interval_handler) clearInterval(options.interval_handler);
    if (options.filename) console.log('STOPPING on  \033[36m' + options.filename +
  	         '\033[39m!');

    options = {};
  },
  filename: function(){return options.filename;}
};




 at SyntaxError: Octal literal in strict mode (106:39)
    at Parser.pp$4.raise (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2221:15)
    at Parser.pp$7.readEscapedChar (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:3023:16)
    at Parser.pp$7.readString (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2935:23)
    at Parser.pp$7.getTokenFromCode (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2724:19)
    at Parser.pp$7.readToken (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2477:17)
    at Parser.readToken (/root/ExpoSE/lib/Tropigate/bin/Tokens.js:124:26)
    at Parser.pp$7.nextToken (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2468:15)
    at Parser.pp$7.next (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2413:10)
    at Parser.pp.eat (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:536:12)
    at Parser.pp$3.parseSubscripts (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:1738:37)
*-- Replay with NO_COMPILE=1 expoSE replay '/root/ExpoSE/lib/Harness/src/harness.js' '{"_bound":0}'
*-- Coverage Data
*- File /root/ExpoSE/lib/Harness/src/harness.js. Coverage (Term): 18% Coverage (LOC): 24%
*- File /root/ExpoSE/lib/S$/bin/symbols.js. Coverage (Term): 16% Coverage (LOC): 34%
*- Re-run with EXPOSE_PRINT_COVERAGE=1 to print line by line coverage information
** ExpoSE Finished. 1 paths with 1 errors **
