
> gina@0.0.9-p91c postinstall /root/Targets/gina/node_modules/gina
> node ./script/post_install.js


creating platform file
> now installing dependencies, please wait ...

installing [ colors@latest ]
installing [ engine.io@latest ]
Wed Sep 20 2017 14:01:43 GMT+0000 (UTC) [ error ] npm WARN deprecated isarray@2.0.1: Just use Array.isArray directly
 
installing [ engine.io-client@latest ]
installing [ express@4.x ]
installing [ multiparty@latest ]
installing [ requirejs@latest ]
installing [ node-uuid@latest ]npm WARN deprecated node-uuid@1.4.8: Use uuid module instead
 
installing [ swig@latest ]
Wed Sep 20 2017 14:02:27 GMT+0000 (UTC) [ error ] npm WARN deprecated swig@1.4.2: This package is no longer maintained
 

Gina's command line tool has been installed !
- after@0.8.2 node_modules/gina/node_modules/after
- amdefine@1.0.1 node_modules/gina/node_modules/amdefine
- array-flatten@1.1.1 node_modules/gina/node_modules/array-flatten
- arraybuffer.slice@0.0.6 node_modules/gina/node_modules/arraybuffer.slice
- async@0.2.10 node_modules/gina/node_modules/async
- base64-arraybuffer@0.1.5 node_modules/gina/node_modules/base64-arraybuffer
- base64id@1.0.0 node_modules/gina/node_modules/base64id
- blob@0.0.4 node_modules/gina/node_modules/blob
- callsite@1.0.0 node_modules/gina/node_modules/callsite
- better-assert@1.0.2 node_modules/gina/node_modules/better-assert
- camelcase@1.2.1 node_modules/gina/node_modules/camelcase
- component-emitter@1.2.1 node_modules/gina/node_modules/component-emitter
- component-inherit@0.0.3 node_modules/gina/node_modules/component-inherit
- content-disposition@0.5.2 node_modules/gina/node_modules/content-disposition
- content-type@1.0.4 node_modules/gina/node_modules/content-type
- cookie@0.3.1 node_modules/gina/node_modules/cookie
- cookie-signature@1.0.6 node_modules/gina/node_modules/cookie-signature
- decamelize@1.2.0 node_modules/gina/node_modules/decamelize
- depd@1.1.1 node_modules/gina/node_modules/depd
- destroy@1.0.4 node_modules/gina/node_modules/destroy
- ee-first@1.1.1 node_modules/gina/node_modules/ee-first
- encodeurl@1.0.1 node_modules/gina/node_modules/encodeurl
- escape-html@1.0.3 node_modules/gina/node_modules/escape-html
- etag@1.8.1 node_modules/gina/node_modules/etag
- forwarded@0.1.2 node_modules/gina/node_modules/forwarded
- fresh@0.5.0 node_modules/gina/node_modules/fresh
- has-cors@1.1.0 node_modules/gina/node_modules/has-cors
- indexof@0.0.1 node_modules/gina/node_modules/indexof
- inherits@2.0.3 node_modules/gina/node_modules/inherits
- ipaddr.js@1.4.0 node_modules/gina/node_modules/ipaddr.js
- isarray@2.0.1 node_modules/gina/node_modules/isarray
- has-binary2@1.0.2 node_modules/gina/node_modules/has-binary2
- engine.io-parser@2.1.1 node_modules/gina/node_modules/engine.io-parser
- media-typer@0.3.0 node_modules/gina/node_modules/media-typer
- merge-descriptors@1.0.1 node_modules/gina/node_modules/merge-descriptors
- methods@1.1.2 node_modules/gina/node_modules/methods
- mime@1.3.4 node_modules/gina/node_modules/mime
- mime-db@1.30.0 node_modules/gina/node_modules/mime-db
- mime-types@2.1.17 node_modules/gina/node_modules/mime-types
- minimist@0.0.10 node_modules/gina/node_modules/minimist
- ms@2.0.0 node_modules/gina/node_modules/ms
- debug@2.6.8 node_modules/gina/node_modules/debug
- negotiator@0.6.1 node_modules/gina/node_modules/negotiator
- accepts@1.3.3 node_modules/gina/node_modules/accepts
- on-finished@2.3.0 node_modules/gina/node_modules/on-finished
- parsejson@0.0.3 node_modules/gina/node_modules/parsejson
- parseqs@0.0.5 node_modules/gina/node_modules/parseqs
- parseuri@0.0.5 node_modules/gina/node_modules/parseuri
- parseurl@1.3.2 node_modules/gina/node_modules/parseurl
- path-to-regexp@0.1.7 node_modules/gina/node_modules/path-to-regexp
- pend@1.2.0 node_modules/gina/node_modules/pend
- fd-slicer@1.0.1 node_modules/gina/node_modules/fd-slicer
- proxy-addr@1.1.5 node_modules/gina/node_modules/proxy-addr
- qs@6.5.0 node_modules/gina/node_modules/qs
- range-parser@1.2.0 node_modules/gina/node_modules/range-parser
- safe-buffer@5.0.1 node_modules/gina/node_modules/safe-buffer
- setprototypeof@1.0.3 node_modules/gina/node_modules/setprototypeof
- source-map@0.1.34 node_modules/gina/node_modules/source-map
- statuses@1.3.1 node_modules/gina/node_modules/statuses
- http-errors@1.6.2 node_modules/gina/node_modules/http-errors
- send@0.15.4 node_modules/gina/node_modules/send
- serve-static@1.12.4 node_modules/gina/node_modules/serve-static
- type-is@1.6.15 node_modules/gina/node_modules/type-is
- uglify-to-browserify@1.0.2 node_modules/gina/node_modules/uglify-to-browserify
- ultron@1.1.0 node_modules/gina/node_modules/ultron
- unpipe@1.0.0 node_modules/gina/node_modules/unpipe
- finalhandler@1.0.5 node_modules/gina/node_modules/finalhandler
- utils-merge@1.0.0 node_modules/gina/node_modules/utils-merge
- uws@0.14.5 node_modules/gina/node_modules/uws
- vary@1.1.1 node_modules/gina/node_modules/vary
- window-size@0.1.0 node_modules/gina/node_modules/window-size
- wordwrap@0.0.3 node_modules/gina/node_modules/wordwrap
- optimist@0.6.1 node_modules/gina/node_modules/optimist
- ws@2.3.1 node_modules/gina/node_modules/ws
- xmlhttprequest-ssl@1.5.3 node_modules/gina/node_modules/xmlhttprequest-ssl
- wordwrap@0.0.2 node_modules/gina/node_modules/yargs/node_modules/wordwrap
- yargs@3.5.4 node_modules/gina/node_modules/yargs
- uglify-js@2.4.24 node_modules/gina/node_modules/uglify-js
- yeast@0.1.2 node_modules/gina/node_modules/yeast
- colors@1.1.2 node_modules/gina/node_modules/colors
- engine.io@3.1.1 node_modules/gina/node_modules/engine.io
- engine.io-client@3.1.1 node_modules/gina/node_modules/engine.io-client
- express@4.15.4 node_modules/gina/node_modules/express
- multiparty@4.1.3 node_modules/gina/node_modules/multiparty
- node-uuid@1.4.8 node_modules/gina/node_modules/node-uuid
- requirejs@2.3.5 node_modules/gina/node_modules/requirejs
- swig@1.4.2 node_modules/gina/node_modules/swig
/root/Targets/gina
└── gina@0.0.9-p91c 

Setup Done exists, not setting up
:../FeatureTester/libs/:/root/Targets/gina/node_modules
Set Default Z3_PATH to ./node_modules/z3javascript/bin/libz3.so
ExpoSE Master: /root/ExpoSE/lib/Harness/src/harness.js max concurrent: 16 max paths: 1000000
Setting timeout to 900000
*** [0 done /0 queued / 1 running / 0 errors / 0% coverage ] ****** [0 done /0 queued / 1 running / 0 errors / 0% coverage ] ****** [1 done /0 queued / 0 running / 1 errors / 7.000000000000001% coverage ] ***
*-- Stat Module Output --*
*-- concretizations: ["defineProperty","bound log"]
*-- Stat Module Done --*
*-- Test Case {"_bound":0} start 0.0395 took 8.6014s
*-- Errors occured in test {"_bound":0}
* Error: Tropigate failed because SyntaxError: Invalid number (222:36) on program /* Gina.Utils.Config
 *
 * This file is part of the gina package.
 * Copyright (c) 2016 Rhinostone <gina@rhinostone.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */


//Imports.
var fs      = require('fs');
var console = require('./logger');
var math    = require('./math');


/**
 * Config constructor
 * @contructor
 * */
function ConfigUtil() {

    var self = this; //, mainConfig

    /**
     * Init
     * @contructor
     * */
    var init = function() {

        if ( !ConfigUtil.instance ) {
            try {
                self.paths = getContext('paths')
            } catch (err) {
                self.paths = {}
            }

            var path = new _(__dirname).toUnixStyle();
            self.__dirname =  _( path.substring(0, (path.length - 4)) );

            ConfigUtil.instance = self;
            return self
        } else {
            self = ConfigUtil.instance;
            return ConfigUtil.instance
        }
    }


    /**
     * Set config file if !exists
     *
     * @param {string} app - App name
     * @param {string} file - File to save
     * @param {object} content - JSON content to save
     * */
    this.set = function(app, file, content, callback){
        switch (app) {
            case 'gina':
            case 'gina.utils':
                setFile(app, file, content, function(err){
                    callback(err);
                });
                break;
        }
    }

    /**
     * Get config file if exists
     *
     * @param {string} project - Project name
     * @param {strins} key - File name to save + .ext
     *
     * @callback callback
     * @param {string|boolean} err
     * @param {object} config - Bundle Configuration
     * */
    this.get = function(project, file, callback){

        var config = null, err = false;

        switch (project) {
            case 'gina':
            case 'gina.utils':
                try {
                    //You are under gina.utils/lib/...
                    if ( typeof(self.value) != "undefined" ) {

                        try {
                            config = self.value;//????
                        } catch (err) {
                            err = 'Utils.Config.get(...) : self.value['+file+'] : key not found.\n' + err;
                        }

                    } else {
                        //Getting paths.
                        if ( typeof(self.paths.root) != 'undefined' ) {
                            //console.error("requiring :=> ",  self.paths.root + '/.gna/locals.json');
                            try {
                                config = require(self.paths.root  + '/.gna/' + file);
                                self.value = config;
                                self.paths = config['paths'];

                            } catch (err) {
                                //Means that the file was not found..
                                console.error(err.stack || err.message);
                                err = new Error(self.__dirname  + '/.gna/locals.json: project configuration file not found.');
                                process.exit(1)
                            }
                        }
                    }
                    callback(err, config)

                } catch (err) {
                    var err = new Error('.gna/locals.json: project configuration file not found. \n' + (err.stack||err.message));
                    //logger.error('gina', 'UTILS:CONFIG:ERR:3', err, __stack);
                    callback(err);
                }
                break;

            default :
                callback('Config.get('+project+'): case not found');
        }
    }

    /**
     * Get sync config file if exists
     *
     * @param {string} app - App name
     * @return {object} config - App Configuration
     *
     * @private
     * */
    this.getSync = function(project, file, i){
        var maxRetry    = 7
            , delay     = 300
            , i         = i || 0;

        if (typeof(file) == 'undefined') {
            var file = 'locals.json'
        }

        if ( typeof(self.value) != "undefined" ) {
            return self.value;
        } else {
            var filename = self.paths.root +'/.gna/'+ file;
            if (i > 0) {
                console.debug('retrying [ '+i+' ] to load: ' + filename)
            }

            try {
                if ( fs.existsSync(filename) ) {
                    return require(filename)
                } else {
                    // you might just be experimenting some latencies
                    if (i < maxRetry) {
                        console.debug('retrying to load config after timeout');
                        setTimeout(function(){
                            console.debug('It is time re reload config');
                            self.getSync(project, file, i+1)
                        }, delay);
                        //return
                    } else {
                        var err = new Error(filename+ ' not found');
                        console.emerg(err.stack||err.message);
                        process.exit(1);
                    }
                }
            } catch (err) {
                if (i < maxRetry) {
                    console.debug('(catched) retrying to load config after timeout');
                    setTimeout(function(){
                        console.debug('It is time re reload config');
                        self.getSync(project, file, i+1)
                    }, delay);
                } else {
                    console.error(err.stack);
                    throw new Error(err.message);
                }
            }
        }
    }

    /**
     * Create a config file
     *
     * @param {string} app - Targeted application
     * @param {string} file - File save
     * @param {string} content - Content fo the file to save
     *
     *
     * TOTO - Avoid systematics file override.
     * @private
     * */

    var setFile = function(app, file, content, callback) {

        var paths = {
            root : content.paths.root,
            utils : content.paths.utils
        };
        var gnaFolder = content.paths.root + '/.gna';

        self.project = content.project;

        self.paths = paths;

        //Create path.
        var createFolder = function(){
            if ( fs.existsSync(gnaFolder) ) {
                if ( !fs.existsSync(gnaFolder +'/'+ file) ) {
                    createContent(gnaFolder +'/'+ file, gnaFolder, content, function(err){
                        setTimeout(function(){
                            callback(err)
                        }, 500)
                    })
                } else { // already existing ... won't overwrite
                    callback(false)
                }

            } else {
                fs.mkdir(gnaFolder, 0777, function(err){
                    if (err) {
                        console.error(err.stack);
                        callback(err)
                    } else {
                        //Creating content.
                        createContent(gnaFolder+ '/' +file, gnaFolder, content, function(err){
                            setTimeout(function(){
                                callback(err)
                            }, 500)
                        })
                    }
                })
            }

        };

        fs.exists(gnaFolder, function(exists){
            if (!exists) {
                createFolder()
            } else {
                // test if decalred path matches real path and overwrite if not the same
                // in case you move your project
                var filename        = _(gnaFolder +'/'+ file, true);
                var checksumFileOld = _(gnaFolder +'/'+ math.checkSumSync( JSON.stringify( require(filename) ), 'sha1'), true) + '.txt';
                var checksumFile    = _(gnaFolder +'/'+ math.checkSumSync( JSON.stringify(content), 'sha1'), true) + '.txt';

                var verified        = (checksumFileOld == checksumFile) ? true : false;


                if ( !fs.existsSync(checksumFile) && fs.existsSync(filename) || !fs.existsSync(filename) || !verified) {
                    if ( fs.existsSync(filename) ) fs.unlinkSync(filename);
                    if ( fs.existsSync(checksumFile) ) fs.unlinkSync(checksumFile);

                    createContent(filename, gnaFolder, content, function(err){
                        fs.openSync(checksumFile, 'w');
                        setTimeout(function(){
                            callback(err)
                        }, 500)
                    })
                } else if ( fs.existsSync(filename) ) {

                    var locals = require(gnaFolder +'/'+ file);

                    if (paths.utils != locals.paths.utils) {

                        new _(gnaFolder).rm( function(err){
                            if (err) {
                                console.warn('found error while trying to remove `.gna`\n' + err.stack)
                            }

                            //setTimeout(function(){
                                //console.debug('Done removing `gnaFolder` : '+ gnaFolder);
                            createFolder();
                            //}, 200);
                        })
                    } else {
                        callback(false)// nothing to do
                    }
                } else {
                    callback(false)// nothing to do
                }
            }
        })
    }


    /**
     * Remove symbolic link
     *
     * @param {string} path
     * @callback callback
     *
     * @private
     * */
    var removeSymlink = function(path, callback){

        fs.exists(path, function(exists){
            if (exists) {
                fs.lstat(path, function(err, stats){
                    if (err) console.error(err.stack);

                    if ( stats.isSymbolicLink() ) fs.unlink(path, function(err){
                        if (err) {
                            console.error(err.stack);
                            callback(err)
                        } else {
                            //Trigger.
                            onSymlinkRemoved(self.paths, function(err){
                                if (err) console.error(err.stack);

                                callback(false)
                            })
                        }
                    })
                })
            } else {
                //log & ignore. This is not a real issue.
                //logger.warn('gina', 'UTILS:CONFIG:WARN:1', 'Path not found: ' + path, __stack);
                console.warn( 'Path not found: ' + path, __stack);
                onSymlinkRemoved(self.paths, function(err){
                    //if (err) logger.error('gina', 'UTILS:CONFIG:ERR:9', err, __stack);
                    if (err) console.error(err.stack||err.message);

                    callback(false)
                })
            }
        })
    }

    /**
     * Symbolic link remove event
     *
     * @param {string} [err]
     * @callback callback
     *
     * @private
     * */
    var onSymlinkRemoved = function(paths, callback){
        //Remove original.
        var p = new _(paths.root + '/.gna');
        var path = p.toString();

        //Remove folers.
        fs.exists(path, function(exists){
            //delete when exists.
            if (exists) {
                //console.log("yeah about to delete main folder: ", p.toString());
                //Delete ans die here..
                p.rm(function(err, path){
                    //console.log("receives ", err, path);
                    if (err) {
                        //logger.error('gina', 'UTILS:CONFIG:ERR:8', err, __stack);
                        console.error(err.stack||err.message);
                        callback(err)
                    } else {
                        //logger.info('gina', 'UTILS:CONFIG:INFO:1', path +': deleted with success !');
                        console.info( path +': deleted with success !');
                        callback(false)
                    }
                })
            }
        })
    }

    /**
     * Create content
     *
     * @param {string} filename - Fullpath
     * @content {string} content
     *
     * @private
     * */
    var createContent = function(filename, gnaFolder, content, callback){
        if ( fs.existsSync(filename) ) {
            fs.unlinkSync(filename)
        }
        fs.appendFile(
            filename,
            JSON.stringify(content, null, '\t'),
            null,
            function(err){
                if (err) {
                    //logger.error('gina', 'UTILS:CONFIG:ERR:2', err, __stack);
                    console.error('`Error on while calling createContent()`: ' + err.stack||err.message);
                    callback(err)
                } else {
                    setTimeout(function(){
                        callback(err)
                    }, 1000)
                }
            }//EO function
        )//EO fs.appendFile
    }

    /**
     * Get var value by namespace
     *
     * @param {string} namespace
     * @param {object} [config ] - Config object
     * @return {*} value - Can be String or Array
     *
     * @private
     * */
    var getVar = function(namespace, config) {
        if ( typeof(config) == "undefined" )
            var config = self.getSync(app);

        if (config != null) {
            var split = namespace.split('.'), k=0;
            while (k<split.length) {
                config = config[split[k++]]
            }
            return config
        } else {
            return null
        }
    }

    /**
     * Get path by app & namespance
     *
     * @param {string} app
     * @param {string} namespace
     *
     * @callback callback
     * @param {string} err
     * @param {string} path
     *
     * @private
     * */
    var getPath = function(app, namespace, callback){

        self.get(app, function(err, config){
            if (err) {
                //logger.error('gina', 'UTILS:CONFIG:ERR:4', err, __stack);
                console.error(err.stack||err.message);
                callback(err + 'Utils.Config.get(...)');
            }

            try {
                callback( false, getVar('paths.' + namespace, config) );

            } catch (err) {
                var err = new Error('Config.getPath(app, cat, callback): cat not found');
                callback(err)
            }
        })
    }


    /**
     * Get project name
     *
     * @return {string} projectName
     *
     * */
    this.getProjectName = function(){
        if ( this.paths != undefined && this.paths.root != undefined ) {
            var arr = this.paths.root.split("/");
            return arr[arr.length-1]
        } else {
            return null
        }
    }

    return init()
};

module.exports = ConfigUtil at SyntaxError: Invalid number (222:36)
    at Parser.pp$4.raise (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2221:15)
    at Parser.pp$7.readNumber (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2896:52)
    at Parser.pp$7.getTokenFromCode (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2720:19)
    at Parser.pp$7.readToken (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2477:17)
    at Parser.readToken (/root/ExpoSE/lib/Tropigate/bin/Tokens.js:124:26)
    at Parser.pp$7.nextToken (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2468:15)
    at Parser.pp$7.next (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2413:10)
    at Parser.pp.eat (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:536:12)
    at Parser.pp.expect (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:597:10)
    at Parser.pp$3.parseExprList (/root/ExpoSE/lib/Tropigate/node_modules/acorn/dist/acorn.js:2152:16)
*-- Replay with NO_COMPILE=1 expoSE replay '/root/ExpoSE/lib/Harness/src/harness.js' '{"_bound":0}'
*-- Coverage Data
*- File /root/ExpoSE/lib/Harness/src/harness.js. Coverage (Term): 18% Coverage (LOC): 24%
*- File /root/ExpoSE/lib/S$/bin/symbols.js. Coverage (Term): 16% Coverage (LOC): 34%
*- File /root/Targets/gina/node_modules/gina/core/gna.js. Coverage (Term): 2% Coverage (LOC): 1%
*- File /root/Targets/gina/node_modules/gina/core/config.js. Coverage (Term): 1% Coverage (LOC): 1%
*- File /root/Targets/gina/node_modules/gina/core/utils/index.js. Coverage (Term): 35% Coverage (LOC): 32%
*- Re-run with EXPOSE_PRINT_COVERAGE=1 to print line by line coverage information
** ExpoSE Finished. 1 paths with 1 errors **
