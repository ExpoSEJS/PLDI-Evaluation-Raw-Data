'use strict';

module.exports = function(options) {

  options = options || {};
  options.encoding = options.encoding ? options.encoding : 'utf8';

  return function (input, submit) {
    if (!input.content) {
      input.content = {};
    }
    var buffer = ''
      , readable = input.openStream();
    readable.setEncoding(options.encoding);
    readable.on('data', function(chunk) {
      buffer += chunk;
    });
    readable.on('error', function(err) {
      submit(err);
    });
    readable.on('end', function() {
      try {
        input.content['json'] = JSON.parse(buffer);
        submit(null, input);
      }
      catch (e) {
        submit(e);
      }
    });
  }

}
