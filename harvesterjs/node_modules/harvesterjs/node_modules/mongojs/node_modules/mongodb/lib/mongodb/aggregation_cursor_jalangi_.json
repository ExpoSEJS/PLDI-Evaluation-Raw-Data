{"8":[3,89,3,154],"9":[1,20,1,27],"10":[9,15,9,30],"16":[9,15,9,30],"17":[1,28,1,32],"18":[11,9,11,33],"24":[10,12,10,39],"25":[1,20,1,33],"26":[11,9,11,45],"32":[11,9,11,45],"33":[1,20,1,33],"34":[22,9,22,36],"40":[22,9,22,49],"41":[1,20,1,33],"42":[22,9,22,49],"48":[24,9,24,45],"49":[2,26,2,38],"50":[24,9,24,33],"56":[28,13,28,42],"57":[2,26,2,45],"58":[24,9,24,45],"64":[32,17,32,20],"65":[2,26,2,45],"66":[28,13,28,28],"72":[38,13,38,42],"73":[2,26,2,45],"74":[28,13,28,42],"80":[43,21,43,24],"81":[3,22,3,29],"82":[38,13,38,28],"88":[41,13,41,65],"89":[3,30,3,60],"90":[38,13,38,42],"96":[51,13,51,42],"97":[3,22,3,61],"98":[41,13,41,65],"104":[55,17,55,20],"105":[3,22,3,76],"106":[51,13,51,28],"112":[61,13,61,24],"113":[3,89,3,96],"114":[51,13,51,42],"120":[65,21,65,24],"121":[3,97,3,105],"122":[61,13,61,24],"128":[67,24,67,43],"129":[3,89,3,106],"130":[63,13,63,64],"136":[63,13,63,64],"137":[3,89,3,115],"138":[67,24,67,43],"144":[78,13,78,42],"145":[3,119,3,126],"146":[78,13,78,28],"152":[80,13,80,24],"153":[3,127,3,144],"154":[78,13,78,42],"160":[85,25,85,28],"161":[3,119,3,145],"162":[80,13,80,24],"168":[89,36,89,40],"169":[3,119,3,154],"170":[82,13,82,64],"176":[83,17,83,25],"177":[3,172,3,179],"178":[83,17,83,25],"184":[93,35,93,39],"185":[3,180,3,198],"186":[98,13,98,28],"192":[82,13,82,64],"193":[3,172,3,199],"194":[98,13,98,42],"200":[98,13,98,42],"201":[3,172,3,213],"202":[100,13,100,24],"208":[100,13,100,24],"209":[3,223,3,230],"210":[102,13,102,64],"216":[102,13,102,64],"217":[3,231,3,240],"218":[117,5,117,21],"224":[109,17,109,20],"225":[3,223,3,241],"232":[117,5,117,21],"233":[3,252,3,259],"241":[3,260,3,281],"249":[3,252,3,282],"257":[3,295,3,302],"265":[3,303,3,309],"273":[3,295,3,310],"281":[3,295,3,319],"289":[3,22,3,76],"297":[3,22,3,76],"305":[3,89,3,154],"313":[3,89,3,154],"321":[3,172,3,213],"329":[3,172,3,213],"337":[3,223,3,241],"345":[3,223,3,241],"353":[3,252,3,282],"361":[3,252,3,282],"369":[3,295,3,319],"377":[3,295,3,319],"385":[5,16,5,18],"393":[5,16,5,18],"401":[5,16,5,18],"409":[6,16,6,20],"417":[6,16,6,20],"425":[6,16,6,20],"433":[7,19,7,23],"441":[7,19,7,23],"449":[7,19,7,23],"457":[8,27,8,29],"465":[8,27,8,29],"473":[8,27,8,29],"481":[9,15,9,22],"489":[9,26,9,30],"497":[9,33,9,35],"505":[9,38,9,45],"513":[9,15,9,45],"521":[9,5,9,46],"529":[10,12,10,17],"537":[10,26,10,33],"545":[10,26,10,38],"553":[10,12,10,39],"555":[10,12,10,25],"561":[10,42,10,49],"569":[10,42,10,54],"577":[10,57,10,61],"585":[10,12,10,61],"593":[10,5,10,62],"601":[11,16,11,23],"609":[11,16,11,33],"617":[11,37,11,45],"625":[12,9,12,24],"633":[12,37,12,44],"641":[12,37,12,54],"649":[12,9,12,54],"657":[12,9,12,55],"665":[13,26,13,32],"673":[13,49,13,59],"681":[13,61,13,68],"689":[13,26,13,69],"691":[13,26,13,48],"697":[13,26,13,69],"705":[13,26,13,69],"713":[14,5,14,13],"721":[14,19,14,23],"729":[14,39,14,43],"737":[14,25,14,45],"745":[14,5,14,46],"747":[14,5,14,18],"753":[14,5,14,47],"761":[15,22,15,26],"769":[15,22,15,26],"777":[15,22,15,26],"785":[16,38,16,52],"793":[16,20,16,54],"801":[16,20,16,54],"809":[16,20,16,54],"817":[18,20,18,30],"825":[18,20,18,45],"833":[19,19,19,23],"841":[20,17,20,32],"849":[17,19,21,6],"857":[17,19,21,6],"865":[17,19,21,6],"873":[22,16,22,23],"881":[22,16,22,36],"889":[22,40,22,49],"897":[23,9,23,16],"905":[23,32,23,39],"913":[23,32,23,52],"921":[23,9,23,52],"929":[23,9,23,53],"937":[24,16,24,23],"945":[24,16,24,33],"953":[24,37,24,45],"961":[25,9,25,16],"969":[25,29,25,36],"977":[25,29,25,46],"985":[25,9,25,46],"993":[25,9,25,47],"1001":[26,29,26,42],"1009":[26,43,26,53],"1017":[26,43,26,56],"1025":[26,58,26,68],"1033":[26,70,26,77],"1041":[26,25,26,78],"1049":[26,25,26,78],"1057":[26,25,26,78],"1065":[27,5,27,9],"1073":[28,20,28,28],"1081":[28,32,28,42],"1089":[29,19,29,24],"1097":[29,33,29,89],"1105":[29,19,29,90],"1107":[29,19,29,32],"1113":[29,19,29,90],"1121":[29,13,29,91],"1129":[30,9,30,17],"1137":[30,28,30,32],"1145":[30,9,30,32],"1153":[30,9,30,33],"1161":[31,9,31,19],"1169":[31,30,31,34],"1177":[31,36,31,44],"1185":[32,17,32,20],"1193":[33,24,33,32],"1201":[33,33,33,36],"1209":[33,38,33,42],"1217":[33,24,33,43],"1225":[33,24,33,43],"1233":[33,17,33,44],"1241":[34,13,34,21],"1249":[34,22,34,26],"1257":[34,28,34,35],"1265":[34,13,34,36],"1273":[34,13,34,37],"1281":[31,46,35,10],"1289":[31,46,35,10],"1297":[31,46,35,10],"1305":[31,46,35,10],"1313":[31,46,35,10],"1321":[31,9,35,11],"1323":[31,9,31,29],"1329":[31,9,35,12],"1337":[27,20,36,6],"1345":[27,20,36,6],"1353":[27,20,36,6],"1361":[27,20,36,6],"1369":[27,5,36,6],"1377":[27,5,36,7],"1385":[37,5,37,9],"1393":[38,20,38,28],"1401":[38,32,38,42],"1409":[39,19,39,24],"1417":[39,33,39,85],"1425":[39,19,39,86],"1427":[39,19,39,32],"1433":[39,19,39,86],"1441":[39,13,39,87],"1449":[40,27,40,37],"1457":[40,27,40,40],"1465":[40,27,40,53],"1473":[40,69,40,77],"1481":[40,69,40,92],"1489":[40,27,40,93],"1491":[40,27,40,68],"1497":[40,27,40,93],"1505":[40,27,40,93],"1513":[41,14,41,25],"1521":[41,14,41,44],"1529":[41,14,41,65],"1537":[42,20,42,30],"1545":[42,41,42,45],"1553":[42,47,42,55],"1561":[43,21,43,24],"1569":[44,28,44,36],"1577":[44,37,44,40],"1585":[44,28,44,41],"1593":[44,28,44,41],"1601":[44,21,44,42],"1609":[45,17,45,25],"1617":[45,26,45,30],"1625":[45,32,45,39],"1633":[45,17,45,40],"1641":[45,17,45,41],"1649":[42,57,46,14],"1657":[42,57,46,14],"1665":[42,57,46,14],"1673":[42,57,46,14],"1681":[42,57,46,14],"1689":[42,20,46,15],"1691":[42,20,42,40],"1697":[42,20,46,15],"1705":[42,13,46,16],"1713":[48,9,48,22],"1721":[48,41,48,52],"1729":[48,27,48,54],"1737":[48,56,48,64],"1745":[48,9,48,65],"1747":[48,9,48,26],"1753":[48,9,48,66],"1761":[37,16,49,6],"1769":[37,16,49,6],"1777":[37,16,49,6],"1785":[37,16,49,6],"1793":[37,16,49,6],"1801":[37,5,49,6],"1809":[37,5,49,7],"1817":[50,5,50,9],"1825":[51,20,51,28],"1833":[51,32,51,42],"1841":[52,19,52,24],"1849":[52,33,52,88],"1857":[52,19,52,89],"1859":[52,19,52,32],"1865":[52,19,52,89],"1873":[52,13,52,90],"1881":[53,9,53,13],"1889":[53,29,53,30],"1897":[53,19,53,32],"1905":[53,9,53,33],"1907":[53,9,53,18],"1913":[53,9,53,34],"1921":[54,9,54,19],"1929":[54,30,54,34],"1937":[54,36,54,44],"1945":[55,17,55,20],"1953":[56,24,56,32],"1961":[56,33,56,36],"1969":[56,24,56,37],"1977":[56,24,56,37],"1985":[56,17,56,38],"1993":[57,13,57,21],"2001":[57,22,57,26],"2009":[57,28,57,35],"2017":[57,36,57,37],"2025":[57,28,57,38],"2033":[57,13,57,39],"2041":[57,13,57,40],"2049":[54,46,58,10],"2057":[54,46,58,10],"2065":[54,46,58,10],"2073":[54,46,58,10],"2081":[54,46,58,10],"2089":[54,9,58,11],"2091":[54,9,54,29],"2097":[54,9,58,12],"2105":[50,19,59,6],"2113":[50,19,59,6],"2121":[50,19,59,6],"2129":[50,19,59,6],"2137":[50,5,59,6],"2145":[50,5,59,7],"2153":[60,5,60,9],"2161":[61,14,61,24],"2169":[62,26,62,36],"2177":[62,26,62,39],"2185":[62,26,62,52],"2193":[62,68,62,76],"2201":[62,68,62,91],"2209":[62,26,62,92],"2211":[62,26,62,67],"2217":[62,26,62,92],"2225":[62,13,62,93],"2233":[63,14,63,24],"2241":[63,14,63,43],"2249":[63,14,63,64],"2257":[64,20,64,30],"2265":[64,41,64,45],"2273":[64,47,64,55],"2281":[65,21,65,24],"2289":[66,28,66,36],"2297":[66,37,66,40],"2305":[66,28,66,41],"2313":[66,28,66,41],"2321":[66,21,66,42],"2329":[67,24,67,32],"2337":[67,24,67,39],"2345":[67,42,67,43],"2353":[68,21,68,29],"2361":[68,30,68,34],"2369":[68,36,68,44],"2377":[68,36,68,52],"2379":[68,36,68,50],"2385":[68,21,68,53],"2393":[68,21,68,54],"2401":[70,17,70,25],"2409":[70,26,70,30],"2417":[70,32,70,36],"2425":[70,17,70,37],"2433":[70,17,70,38],"2441":[64,57,71,14],"2449":[64,57,71,14],"2457":[64,57,71,14],"2465":[64,57,71,14],"2473":[64,57,71,14],"2481":[64,20,71,15],"2483":[64,20,64,40],"2489":[64,20,71,15],"2497":[64,13,71,16],"2505":[73,9,73,22],"2513":[73,42,73,52],"2521":[73,28,73,54],"2529":[74,13,74,21],"2537":[74,22,74,25],"2545":[74,27,74,30],"2553":[74,13,74,31],"2561":[74,13,74,32],"2569":[73,56,75,10],"2577":[73,56,75,10],"2585":[73,56,75,10],"2593":[73,56,75,10],"2601":[73,56,75,10],"2609":[73,9,75,11],"2611":[73,9,73,27],"2617":[73,9,75,12],"2625":[60,17,76,6],"2633":[60,17,76,6],"2641":[60,17,76,6],"2649":[60,17,76,6],"2657":[60,5,76,6],"2665":[60,5,76,7],"2673":[77,5,77,9],"2681":[78,20,78,28],"2689":[78,32,78,42],"2697":[79,19,79,24],"2705":[79,33,79,86],"2713":[79,19,79,87],"2715":[79,19,79,32],"2721":[79,19,79,87],"2729":[79,13,79,88],"2737":[80,14,80,24],"2745":[81,26,81,36],"2753":[81,26,81,39],"2761":[81,26,81,52],"2769":[81,68,81,76],"2777":[81,68,81,91],"2785":[81,26,81,92],"2787":[81,26,81,67],"2793":[81,26,81,92],"2801":[81,13,81,93],"2809":[82,14,82,24],"2817":[82,14,82,43],"2825":[82,14,82,64],"2833":[83,18,83,25],"2841":[84,24,84,34],"2849":[84,45,84,49],"2857":[84,51,84,59],"2865":[85,25,85,28],"2873":[86,32,86,40],"2881":[86,41,86,44],"2889":[86,32,86,45],"2897":[86,32,86,45],"2905":[86,25,86,46],"2913":[87,31,87,39],"2921":[87,31,87,39],"2929":[87,21,87,40],"2937":[88,32,88,39],"2945":[88,32,88,47],"2947":[88,32,88,45],"2953":[88,32,88,47],"2961":[88,32,88,47],"2969":[89,21,89,29],"2977":[89,30,89,34],"2985":[89,36,89,40],"2993":[89,43,89,47],"3001":[89,50,89,54],"3009":[89,21,89,55],"3017":[89,21,89,56],"3025":[84,61,90,18],"3033":[84,61,90,18],"3041":[84,61,90,18],"3049":[84,61,90,18],"3057":[84,61,90,18],"3065":[84,61,90,18],"3073":[84,24,90,19],"3075":[84,24,84,44],"3081":[84,24,90,19],"3089":[84,17,90,20],"3097":[92,24,92,31],"3105":[92,24,92,39],"3107":[92,24,92,37],"3113":[92,24,92,39],"3121":[92,24,92,39],"3129":[93,20,93,28],"3137":[93,29,93,33],"3145":[93,35,93,39],"3153":[93,42,93,46],"3161":[93,49,93,53],"3169":[93,20,93,54],"3177":[93,20,93,54],"3185":[93,13,93,55],"3193":[95,9,95,22],"3201":[95,42,95,52],"3209":[95,28,95,54],"3217":[95,56,95,64],"3225":[95,9,95,65],"3227":[95,9,95,27],"3233":[95,9,95,66],"3241":[77,17,96,6],"3249":[77,17,96,6],"3257":[77,17,96,6],"3265":[77,17,96,6],"3273":[77,17,96,6],"3281":[77,5,96,6],"3289":[77,5,96,7],"3297":[97,5,97,9],"3305":[98,20,98,28],"3313":[98,32,98,42],"3321":[99,19,99,24],"3329":[99,33,99,87],"3337":[99,19,99,88],"3339":[99,19,99,32],"3345":[99,19,99,88],"3353":[99,13,99,89],"3361":[100,14,100,24],"3369":[101,26,101,36],"3377":[101,26,101,39],"3385":[101,26,101,52],"3393":[101,68,101,76],"3401":[101,68,101,91],"3409":[101,26,101,92],"3411":[101,26,101,67],"3417":[101,26,101,92],"3425":[101,13,101,93],"3433":[102,14,102,24],"3441":[102,14,102,43],"3449":[102,14,102,64],"3457":[103,20,103,28],"3465":[103,29,103,33],"3473":[103,35,103,39],"3481":[103,20,103,40],"3489":[103,20,103,40],"3497":[103,13,103,41],"3505":[105,9,105,22],"3513":[105,29,105,37],"3521":[105,9,105,38],"3523":[105,9,105,28],"3529":[105,9,105,39],"3537":[97,18,106,6],"3545":[97,18,106,6],"3553":[97,18,106,6],"3561":[97,18,106,6],"3569":[97,5,106,6],"3577":[97,5,106,7],"3585":[107,5,107,9],"3593":[108,9,108,13],"3601":[109,17,109,20],"3609":[110,17,110,21],"3617":[110,27,110,34],"3625":[110,36,110,39],"3633":[110,17,110,40],"3635":[110,17,110,26],"3641":[110,17,110,41],"3649":[111,24,111,28],"3657":[111,34,111,38],"3665":[111,24,111,39],"3667":[111,24,111,33],"3673":[111,24,111,39],"3681":[111,17,111,40],"3689":[113,13,113,17],"3697":[113,23,113,29],"3705":[113,13,113,30],"3707":[113,13,113,22],"3713":[113,13,113,31],"3721":[108,19,114,10],"3729":[108,19,114,10],"3737":[108,19,114,10],"3745":[108,19,114,10],"3753":[108,19,114,10],"3761":[108,9,114,11],"3763":[108,9,108,18],"3769":[108,9,114,12],"3777":[107,18,115,6],"3785":[107,18,115,6],"3793":[107,18,115,6],"3801":[107,18,115,6],"3809":[107,5,115,6],"3817":[107,5,115,7],"3825":[4,25,116,2],"3833":[4,25,116,2],"3841":[4,25,116,2],"3849":[4,25,116,2],"3857":[4,25,116,2],"3865":[4,25,116,2],"3873":[4,25,116,2],"3881":[4,25,116,2],"3889":[4,25,116,2],"3897":[4,25,116,2],"3905":[4,25,116,2],"3913":[4,25,116,2],"3921":[4,25,116,2],"3929":[4,25,116,2],"3937":[4,25,116,2],"3945":[4,25,116,2],"3953":[4,25,116,2],"3961":[117,5,117,13],"3969":[117,17,117,21],"3977":[118,5,118,13],"3985":[118,14,118,31],"3993":[118,33,118,41],"4001":[118,5,118,42],"4009":[118,5,118,43],"4017":[120,1,120,8],"4025":[120,29,120,46],"4033":[120,1,120,46],"4041":[120,1,120,47],"4049":[1,1,120,47],"4057":[1,1,120,47],"4065":[1,1,120,47],"4073":[1,1,120,47],"4081":[1,1,120,47],"4089":[1,1,120,47],"4097":[1,1,120,47],"4105":[1,1,120,47],"4113":[1,1,120,47],"4121":[1,1,120,47],"4129":[9,15,9,45],"4137":[10,12,10,61],"4145":[11,5,12,55],"4153":[22,5,23,53],"4161":[24,5,25,47],"4169":[28,9,29,91],"4177":[32,13,33,44],"4185":[31,46,35,10],"4193":[31,46,35,10],"4201":[27,20,36,6],"4209":[27,20,36,6],"4217":[38,9,39,87],"4225":[43,17,44,42],"4233":[42,57,46,14],"4241":[42,57,46,14],"4249":[41,9,47,10],"4257":[37,16,49,6],"4265":[37,16,49,6],"4273":[51,9,52,90],"4281":[55,13,56,38],"4289":[54,46,58,10],"4297":[54,46,58,10],"4305":[50,19,59,6],"4313":[50,19,59,6],"4321":[61,9,62,93],"4329":[65,17,66,42],"4337":[67,17,69,18],"4345":[64,57,71,14],"4353":[64,57,71,14],"4361":[63,9,72,10],"4369":[73,56,75,10],"4377":[73,56,75,10],"4385":[60,17,76,6],"4393":[60,17,76,6],"4401":[78,9,79,88],"4409":[80,9,81,93],"4417":[85,21,86,46],"4425":[89,36,89,54],"4433":[84,61,90,18],"4441":[84,61,90,18],"4449":[83,13,91,14],"4457":[93,35,93,53],"4465":[82,9,94,10],"4473":[77,17,96,6],"4481":[77,17,96,6],"4489":[98,9,99,89],"4497":[100,9,101,93],"4505":[102,9,104,10],"4513":[97,18,106,6],"4521":[97,18,106,6],"4529":[109,13,112,14],"4537":[108,19,114,10],"4545":[108,19,114,10],"4553":[107,18,115,6],"4561":[107,18,115,6],"4569":[4,25,116,2],"4577":[4,25,116,2],"4585":[117,1,119,2],"4593":[1,1,120,47],"4601":[1,1,120,47],"nBranches":58,"originalCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/aggregation_cursor.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/aggregation_cursor_jalangi_.js","code":"var ReadPreference = require('./connection/read_preference').ReadPreference\n\t, Readable = require('stream').Readable || require('readable-stream').Readable\n\t, CommandCursor = require('./command_cursor').CommandCursor\n\t, utils = require('./utils')\n\t, shared = require('./collection/shared')\n\t, inherits = require('util').inherits;\n\nvar AggregationCursor = function(collection, serverCapabilities, options) {\t\n\tvar pipe = [];\n\tvar self = this;\n\tvar results = null;\t\n\tvar _cursor_options = {};\n\t// Ensure we have options set up\n\toptions = options == null ? {} : options;\n\n\t// If a pipeline was provided\n\tpipe = Array.isArray(options.pipe) ? options.pipe : pipe;\n\t// Set passed in batchSize if provided\n\tif(typeof options.batchSize == 'number') _cursor_options.batchSize = options.batchSize;\n\t// Get the read Preference\n\tvar readPreference = shared._getReadConcern(collection, options);\n\n\t// Set up\n\tReadable.call(this, {objectMode: true});\n\n\t// Contains connection\n\tvar connection = null;\n\n\t// Set the read preference\n\tvar _options = { \n\t\treadPreference: readPreference\n\t};\n\n\t// Actual command\n\tvar command = {\n\t\t\taggregate: collection.collectionName\n\t\t, pipeline: pipe\n\t\t, cursor: _cursor_options\n\t}\n\n\t// If allowDiskUse is set\n\tif(typeof options.allowDiskUse == 'boolean') \n\t\tcommand.allowDiskUse = options.allowDiskUse;\n\n  // If maxTimeMS is set\n  if(typeof options.maxTimeMS == 'number')\n    command.maxTimeMS = options.maxTimeMS;\n\n\t// Command cursor (if we support one)\n\tvar commandCursor = new CommandCursor(collection.db, collection, command);\n\n\tthis.explain = function(callback) {\n\t\tif(typeof callback != 'function') \n\t\t\tthrow utils.toError(\"AggregationCursor explain requires a callback function\");\n\t\t\n\t\t// Add explain options\n\t\t_options.explain = true;\n\t\t// Execute aggregation pipeline\n\t\tcollection.aggregate(pipe, _options, function(err, results) {\n\t\t\tif(err) return callback(err, null);\n\t\t\tcallback(null, results);\n\t\t});\n\t}\n\n\tthis.get = function(callback) {\n\t\tif(typeof callback != 'function') \n\t\t\tthrow utils.toError(\"AggregationCursor get requires a callback function\");\t\t\n\t  // Checkout a connection\n\t  var _connection = collection.db.serverConfig.checkoutReader(_options.readPreference);\n\t  // Fall back\n\t\tif(!_connection.serverCapabilities.hasAggregationCursor) {\n\t\t\treturn collection.aggregate(pipe, _options, function(err, results) {\n\t\t\t\tif(err) return callback(err);\n\t\t\t\tcallback(null, results);\n\t\t\t});\t\t\t\n\t\t}\n\n\t\t// Execute get using command Cursor\n\t\tcommandCursor.get({connection: _connection}, callback);\n\t}\n\n\tthis.getOne = function(callback) {\n\t\tif(typeof callback != 'function') \n\t\t\tthrow utils.toError(\"AggregationCursor getOne requires a callback function\");\t\t\n\t\t// Set the limit to 1\n\t\tpipe.push({$limit: 1});\n\t\t// For now we have no cursor command so let's just wrap existing results\n\t\tcollection.aggregate(pipe, _options, function(err, results) {\n\t\t\tif(err) return callback(err);\n\t\t\tcallback(null, results[0]);\n\t\t});\n\t}\n\n\tthis.each = function(callback) {\n\t  // Checkout a connection if we have none\n\t  if(!connection)\n\t  \tconnection = collection.db.serverConfig.checkoutReader(_options.readPreference);\n\t  \n\t  // Fall back\n\t\tif(!connection.serverCapabilities.hasAggregationCursor) {\n\t\t\treturn collection.aggregate(pipe, _options, function(err, _results) {\n\t\t\t\tif(err) return callback(err);\n\n\t\t\t\twhile(_results.length > 0) {\n\t\t\t\t\tcallback(null, _results.shift());\n\t\t\t\t}\n\n\t\t\t\tcallback(null, null);\n\t\t\t});\n\t\t}\n\n\t\t// Execute each using command Cursor\n\t\tcommandCursor.each({connection: connection}, function(err, doc) {\n\t\t\tcallback(err, doc);\n\t\t});\t\t\n\t}\n\n\tthis.next = function(callback) {\n\t\tif(typeof callback != 'function') \n\t\t\tthrow utils.toError(\"AggregationCursor next requires a callback function\");\t\t\n\n\t  // Checkout a connection if we have none\n\t  if(!connection)\n\t  \tconnection = collection.db.serverConfig.checkoutReader(_options.readPreference);\n\t  \n\t  // Fall back\n\t\tif(!connection.serverCapabilities.hasAggregationCursor) {\n\t\t\tif(!results) {\n\t\t\t\t// For now we have no cursor command so let's just wrap existing results\n\t\t\t\treturn collection.aggregate(pipe, _options, function(err, _results) {\n\t\t\t\t\tif(err) return callback(err);\n\t\t\t\t\tresults = _results;\n\t        \n\t        // Ensure we don't issue undefined\n\t        var item = results.shift();\n\t        callback(null, item ? item : null);\n\t\t\t\t});\t\t\t\n\t\t\t}\n\n\t    // Ensure we don't issue undefined\n\t    var item = results.shift();\n\t    // Return the item\n\t    return callback(null, item ? item : null);\n\t  }\n\n\t\t// Execute next using command Cursor\n\t\tcommandCursor.next({connection: connection}, callback);\t\t\n\t}\n\n\t//\n\t// Close method\n\t//\n\tthis.close = function(callback) {\n\t\tif(typeof callback != 'function') \n\t\t\tthrow utils.toError(\"AggregationCursor close requires a callback function\");\t\t\n\n\t  // Checkout a connection if we have none\n\t  if(!connection)\n\t  \tconnection = collection.db.serverConfig.checkoutReader(_options.readPreference);\n\n\t  // Fall back\n\t\tif(!connection.serverCapabilities.hasAggregationCursor) {\n\t\t\treturn callback(null, null);\n\t\t}\n\n\t\t// Execute next using command Cursor\n\t\tcommandCursor.close(callback);\t\t\n\t}\n\n\t//\n\t// Stream method\n\t//\n\tthis._read = function(n) {\n\t\tself.next(function(err, result) {\n\t\t\tif(err) {\n\t\t\t\tself.emit('error', err);\n\t\t\t\treturn self.push(null);\n\t\t\t}\n\n\t\t\tself.push(result);\n\t\t});\n\t}\n}\n\n// Inherit from Readable\nif(Readable != null) {\n\tinherits(AggregationCursor, Readable);\t\n}\n\n// Exports the Aggregation Framework\nexports.AggregationCursor = AggregationCursor;\n"}