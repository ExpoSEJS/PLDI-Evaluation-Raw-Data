{"8":[6,9,6,38],"9":[1,20,1,27],"10":[6,11,6,37],"16":[31,9,31,56],"17":[1,28,1,32],"18":[6,9,6,38],"24":[31,9,31,56],"25":[1,20,1,33],"26":[9,23,9,33],"32":[39,9,39,67],"33":[1,20,1,33],"34":[9,22,9,33],"40":[44,9,44,96],"41":[1,20,1,33],"42":[11,24,11,55],"48":[44,9,44,96],"49":[2,26,2,38],"50":[19,37,19,69],"56":[57,29,57,32],"57":[2,26,2,45],"58":[20,48,20,90],"64":[55,21,55,42],"65":[2,26,2,45],"66":[20,30,20,90],"72":[54,17,54,40],"73":[2,26,2,45],"74":[31,9,31,29],"80":[75,25,75,59],"81":[3,14,3,21],"82":[31,33,31,56],"88":[73,21,73,24],"89":[3,22,3,30],"90":[39,44,39,67],"96":[81,21,81,41],"97":[3,14,3,31],"98":[39,9,39,67],"104":[51,13,51,26],"105":[3,14,3,38],"106":[44,9,44,35],"112":[90,9,90,83],"113":[3,49,3,56],"114":[44,39,44,92],"120":[90,9,90,83],"121":[3,57,3,65],"122":[44,39,44,96],"128":[103,9,103,24],"129":[3,49,3,66],"130":[45,46,45,99],"136":[108,9,108,23],"137":[3,75,3,82],"138":[51,13,51,26],"144":[115,9,115,48],"145":[3,83,3,89],"146":[54,17,54,40],"152":[115,9,115,48],"153":[3,75,3,90],"154":[55,21,55,42],"161":[3,14,3,38],"162":[72,30,72,65],"169":[3,14,3,38],"170":[75,25,75,59],"177":[3,49,3,66],"178":[81,21,81,41],"185":[3,49,3,66],"186":[90,9,90,21],"193":[3,75,3,90],"194":[90,25,90,83],"201":[3,75,3,90],"202":[91,35,91,62],"209":[4,17,4,24],"210":[103,9,103,24],"217":[4,25,4,35],"218":[115,9,115,30],"225":[4,17,4,36],"226":[115,34,115,48],"233":[4,17,4,48],"235":[4,17,4,46],"241":[4,17,4,48],"249":[4,17,4,48],"257":[6,11,6,15],"265":[6,27,6,37],"273":[7,20,7,30],"281":[7,31,7,40],"289":[7,42,7,48],"297":[7,16,7,49],"305":[7,16,7,49],"313":[7,9,7,50],"321":[8,5,8,11],"329":[8,17,8,21],"337":[8,5,8,22],"339":[8,5,8,16],"345":[8,5,8,23],"353":[9,5,9,9],"361":[9,24,9,33],"369":[9,5,9,33],"377":[9,5,9,34],"385":[10,5,10,9],"393":[10,19,10,25],"401":[10,5,10,25],"409":[10,5,10,26],"417":[11,5,11,9],"425":[11,24,11,30],"433":[11,24,11,37],"441":[11,40,11,46],"449":[11,40,11,55],"457":[11,5,11,55],"465":[11,5,11,56],"473":[12,5,12,9],"481":[12,28,12,29],"489":[12,5,12,29],"497":[12,5,12,30],"505":[13,5,13,9],"513":[13,31,13,37],"521":[13,31,13,50],"529":[13,31,13,62],"537":[13,5,13,62],"545":[13,5,13,63],"553":[14,5,14,9],"561":[14,19,14,24],"569":[14,5,14,24],"577":[14,5,14,25],"585":[15,5,15,9],"593":[15,21,15,25],"601":[15,5,15,25],"609":[15,5,15,26],"617":[16,5,16,9],"625":[16,25,16,29],"633":[16,5,16,29],"641":[16,5,16,30],"649":[17,5,17,9],"657":[17,22,17,27],"665":[17,5,17,27],"673":[17,5,17,28],"681":[18,5,18,9],"689":[18,22,18,27],"697":[18,5,18,27],"705":[18,5,18,28],"713":[19,5,19,9],"721":[19,27,19,31],"729":[19,37,19,43],"737":[19,37,19,50],"745":[19,53,19,59],"753":[19,53,19,69],"761":[19,27,19,70],"763":[19,27,19,36],"769":[19,5,19,70],"777":[19,5,19,71],"785":[20,5,20,9],"793":[20,30,20,36],"801":[20,30,20,45],"809":[20,48,20,52],"817":[20,48,20,71],"825":[20,74,20,80],"833":[20,74,20,90],"841":[20,5,20,90],"849":[20,5,20,91],"857":[21,16,21,20],"865":[21,16,21,20],"873":[21,16,21,20],"881":[22,5,22,14],"889":[23,9,23,13],"897":[23,9,23,24],"899":[23,9,23,22],"905":[23,9,23,25],"913":[22,15,24,6],"921":[22,15,24,6],"929":[22,15,24,6],"937":[22,5,24,7],"945":[22,5,24,8],"953":[5,1,25,2],"961":[5,1,25,2],"969":[5,1,25,2],"977":[5,1,25,2],"985":[5,1,25,2],"993":[27,1,27,11],"1001":[27,1,27,21],"1009":[27,34,27,40],"1017":[27,34,27,50],"1025":[27,1,27,50],"1033":[27,1,27,51],"1041":[28,1,28,11],"1049":[28,1,28,21],"1057":[28,1,28,30],"1065":[28,1,28,31],"1073":[29,1,29,11],"1081":[29,1,29,21],"1089":[29,1,29,28],"1097":[29,1,29,29],"1105":[30,1,30,11],"1113":[30,1,30,21],"1121":[31,9,31,13],"1129":[31,9,31,20],"1137":[31,25,31,29],"1145":[31,33,31,37],"1153":[31,33,31,46],"1161":[31,51,31,56],"1169":[32,9,32,16],"1177":[32,9,32,16],"1185":[34,18,34,22],"1193":[34,18,34,29],"1201":[34,18,34,29],"1209":[34,18,34,29],"1217":[35,16,35,20],"1225":[35,16,35,20],"1233":[35,16,35,20],"1241":[36,5,36,9],"1249":[36,22,36,26],"1257":[36,5,36,26],"1265":[36,5,36,27],"1273":[37,16,37,21],"1281":[37,16,37,21],"1289":[37,16,37,21],"1297":[38,18,38,19],"1305":[38,18,38,19],"1313":[38,18,38,19],"1321":[39,9,39,15],"1329":[39,9,39,28],"1337":[39,9,39,40],"1345":[39,44,39,48],"1353":[39,44,39,63],"1361":[39,66,39,67],"1369":[40,9,40,13],"1377":[40,26,40,31],"1385":[40,9,40,31],"1393":[40,9,40,32],"1401":[41,16,41,20],"1409":[41,16,41,20],"1417":[41,9,41,21],"1425":[43,16,43,20],"1433":[43,16,43,20],"1441":[43,16,43,20],"1449":[44,9,44,13],"1457":[44,9,44,31],"1465":[44,34,44,35],"1473":[44,39,44,45],"1481":[44,39,44,58],"1489":[44,39,44,67],"1491":[44,39,44,65],"1497":[44,70,44,74],"1505":[44,70,44,92],"1513":[44,95,44,96],"1521":[45,16,45,22],"1529":[45,16,45,35],"1537":[45,46,45,52],"1545":[45,46,45,65],"1553":[45,46,45,74],"1555":[45,46,45,72],"1561":[45,77,45,81],"1569":[45,77,45,99],"1577":[45,16,45,100],"1579":[45,16,45,45],"1585":[45,16,45,100],"1593":[45,9,45,101],"1601":[46,9,46,13],"1609":[46,34,46,35],"1617":[46,9,46,35],"1625":[46,9,46,36],"1633":[48,16,48,22],"1641":[48,16,48,35],"1649":[48,46,48,52],"1657":[48,46,48,65],"1665":[48,46,48,74],"1667":[48,46,48,72],"1673":[48,16,48,75],"1675":[48,16,48,45],"1681":[48,16,48,75],"1689":[48,9,48,76],"1697":[51,13,51,17],"1705":[51,22,51,26],"1713":[52,13,52,17],"1721":[52,29,52,34],"1729":[52,13,52,34],"1737":[52,13,52,35],"1745":[53,13,53,17],"1753":[53,23,53,28],"1761":[53,13,53,29],"1763":[53,13,53,22],"1769":[53,13,53,30],"1777":[54,17,54,21],"1785":[54,17,54,31],"1793":[54,36,54,40],"1801":[55,21,55,27],"1809":[55,21,55,32],"1817":[55,33,55,34],"1825":[55,21,55,35],"1833":[55,39,55,42],"1841":[56,21,56,27],"1849":[57,29,57,32],"1857":[58,29,58,33],"1865":[58,39,58,46],"1873":[58,48,58,51],"1881":[58,29,58,52],"1883":[58,29,58,38],"1889":[58,29,58,53],"1897":[59,29,59,36],"1905":[59,29,59,36],"1913":[61,25,61,29],"1921":[61,41,61,46],"1929":[61,25,61,46],"1937":[61,25,61,47],"1945":[62,25,62,29],"1953":[62,42,62,46],"1961":[62,25,62,46],"1969":[62,25,62,47],"1977":[63,25,63,29],"1985":[63,35,63,42],"1993":[63,44,63,47],"2001":[63,25,63,48],"2003":[63,25,63,34],"2009":[63,25,63,49],"2017":[56,34,64,22],"2025":[56,34,64,22],"2033":[56,34,64,22],"2041":[56,34,64,22],"2049":[56,34,64,22],"2057":[56,21,64,23],"2059":[56,21,56,33],"2065":[56,21,64,24],"2073":[66,21,66,25],"2081":[66,37,66,42],"2089":[66,21,66,42],"2097":[66,21,66,43],"2105":[67,21,67,25],"2113":[67,38,67,42],"2121":[67,21,67,42],"2129":[67,21,67,43],"2137":[68,21,68,25],"2145":[68,31,68,38],"2153":[68,21,68,39],"2155":[68,21,68,30],"2161":[68,21,68,40],"2169":[72,13,72,19],"2177":[72,30,72,36],"2185":[72,30,72,49],"2193":[72,30,72,61],"2201":[72,64,72,65],"2209":[73,21,73,24],"2217":[74,21,74,25],"2225":[74,37,74,42],"2233":[74,21,74,42],"2241":[74,21,74,43],"2249":[75,25,75,29],"2257":[75,40,75,47],"2265":[75,25,75,48],"2267":[75,25,75,39],"2273":[75,25,75,55],"2281":[75,58,75,59],"2289":[76,25,76,29],"2297":[76,35,76,42],"2305":[76,44,76,47],"2313":[76,25,76,48],"2315":[76,25,76,34],"2321":[76,25,76,49],"2329":[77,21,77,25],"2337":[77,38,77,43],"2345":[77,21,77,43],"2353":[77,21,77,44],"2361":[78,21,78,28],"2369":[78,21,78,28],"2377":[80,17,80,21],"2385":[80,37,80,42],"2393":[80,17,80,42],"2401":[80,17,80,43],"2409":[81,21,81,25],"2417":[81,21,81,32],"2425":[81,37,81,41],"2433":[82,21,82,25],"2441":[82,38,82,43],"2449":[82,21,82,43],"2457":[82,21,82,44],"2465":[83,21,83,28],"2473":[83,21,83,28],"2481":[85,17,85,23],"2489":[85,39,85,43],"2497":[85,39,85,56],"2505":[85,17,85,56],"2513":[85,17,85,57],"2521":[86,17,86,21],"2529":[86,17,86,32],"2531":[86,17,86,30],"2537":[86,17,86,33],"2545":[72,67,87,14],"2553":[72,67,87,14],"2561":[72,67,87,14],"2569":[72,67,87,14],"2577":[72,67,87,14],"2585":[72,13,87,15],"2587":[72,13,72,29],"2593":[72,13,87,16],"2601":[50,23,89,6],"2609":[50,23,89,6],"2617":[50,23,89,6],"2625":[50,23,89,6],"2633":[50,23,89,6],"2641":[90,9,90,13],"2649":[90,17,90,21],"2657":[90,25,90,31],"2665":[90,25,90,44],"2673":[90,25,90,56],"2681":[90,60,90,64],"2689":[90,60,90,83],"2697":[91,9,91,13],"2705":[91,35,91,39],"2713":[91,35,91,58],"2721":[91,61,91,62],"2729":[91,9,91,62],"2737":[91,9,91,63],"2745":[92,9,92,13],"2753":[92,33,92,37],"2761":[92,33,92,44],"2769":[92,9,92,44],"2771":[92,9,92,44],"2777":[92,9,92,45],"2785":[93,9,93,13],"2793":[93,29,93,33],"2801":[93,9,93,33],"2809":[93,9,93,34],"2817":[94,9,94,16],"2825":[95,13,95,17],"2833":[95,23,95,29],"2841":[95,31,95,35],"2849":[95,13,95,36],"2851":[95,13,95,22],"2857":[95,13,95,37],"2865":[96,13,96,24],"2873":[96,13,96,26],"2881":[96,13,96,27],"2889":[94,26,97,10],"2897":[94,26,97,10],"2905":[94,26,97,10],"2913":[94,9,97,11],"2915":[94,9,94,25],"2921":[94,9,97,12],"2929":[99,9,99,20],"2937":[99,9,99,22],"2945":[99,9,99,23],"2953":[30,33,101,2],"2961":[30,33,101,2],"2969":[30,33,101,2],"2977":[30,33,101,2],"2985":[30,33,101,2],"2993":[30,33,101,2],"3001":[30,33,101,2],"3009":[30,33,101,2],"3017":[30,33,101,2],"3025":[30,1,101,2],"3033":[30,1,101,3],"3041":[102,1,102,11],"3049":[102,1,102,21],"3057":[103,10,103,14],"3065":[103,10,103,24],"3073":[104,9,104,13],"3081":[104,23,104,27],"3089":[104,9,104,27],"3097":[104,9,104,28],"3105":[102,30,106,2],"3113":[102,30,106,2],"3121":[102,30,106,2],"3129":[102,1,106,2],"3137":[102,1,106,3],"3145":[107,1,107,11],"3153":[107,1,107,21],"3161":[108,9,108,13],"3169":[108,9,108,23],"3177":[109,9,109,16],"3185":[109,9,109,16],"3193":[110,5,110,9],"3201":[110,22,110,26],"3209":[110,5,110,26],"3217":[110,5,110,27],"3225":[111,5,111,9],"3233":[111,21,111,26],"3241":[111,5,111,26],"3249":[111,5,111,27],"3257":[112,5,112,9],"3265":[112,15,112,22],"3273":[112,5,112,23],"3275":[112,5,112,14],"3281":[112,5,112,24],"3289":[107,32,113,2],"3297":[107,32,113,2],"3305":[107,32,113,2],"3313":[107,1,113,2],"3321":[107,1,113,3],"3329":[114,1,114,11],"3337":[114,1,114,21],"3345":[115,9,115,13],"3353":[115,9,115,20],"3361":[115,25,115,30],"3369":[115,35,115,39],"3377":[115,35,115,48],"3385":[116,9,116,16],"3393":[116,9,116,16],"3401":[118,5,118,9],"3409":[118,19,118,24],"3417":[118,5,118,24],"3425":[118,5,118,25],"3433":[119,16,119,20],"3441":[119,16,119,20],"3449":[119,16,119,20],"3457":[120,5,120,14],"3465":[121,9,121,13],"3473":[121,9,121,24],"3475":[121,9,121,22],"3481":[121,9,121,25],"3489":[120,15,122,6],"3497":[120,15,122,6],"3505":[120,15,122,6],"3513":[120,5,122,7],"3521":[120,5,122,8],"3529":[114,31,123,2],"3537":[114,31,123,2],"3545":[114,31,123,2],"3553":[114,31,123,2],"3561":[114,1,123,2],"3569":[114,1,123,3],"3577":[124,1,124,8],"3585":[124,22,124,32],"3593":[124,1,124,32],"3601":[124,1,124,33],"3609":[1,1,124,33],"3617":[1,1,124,33],"3625":[1,1,124,33],"3633":[1,1,124,33],"3641":[1,1,124,33],"3649":[1,1,124,33],"3657":[1,1,124,33],"3665":[5,1,25,2],"3673":[1,1,124,33],"3681":[6,5,7,50],"3689":[22,15,24,6],"3697":[22,15,24,6],"3705":[5,1,25,2],"3713":[5,1,25,2],"3721":[31,5,33,6],"3729":[39,5,42,6],"3737":[44,5,49,6],"3745":[57,25,60,26],"3753":[56,34,64,22],"3761":[56,34,64,22],"3769":[55,17,69,18],"3777":[54,13,70,14],"3785":[75,21,76,49],"3793":[73,17,79,18],"3801":[81,17,84,18],"3809":[72,67,87,14],"3817":[72,67,87,14],"3825":[51,9,88,10],"3833":[50,23,89,6],"3841":[50,23,89,6],"3849":[94,26,97,10],"3857":[94,26,97,10],"3865":[90,5,100,6],"3873":[30,33,101,2],"3881":[30,33,101,2],"3889":[103,5,105,6],"3897":[102,30,106,2],"3905":[102,30,106,2],"3913":[108,5,109,16],"3921":[107,32,113,2],"3929":[107,32,113,2],"3937":[115,5,117,6],"3945":[120,15,122,6],"3953":[120,15,122,6],"3961":[114,31,123,2],"3969":[114,31,123,2],"3977":[1,1,124,33],"3985":[1,1,124,33],"nBranches":38,"originalCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/gridfs/readstream.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/gridfs/readstream_jalangi_.js","code":"var Stream = require('stream').Stream,\n  timers = require('timers'),\n  util = require('util');\n\n// Set processor, setImmediate if 0.10 otherwise nextTick\nvar processor = require('../utils').processor();\n\n/**\n * ReadStream\n *\n * Returns a stream interface for the **file**.\n *\n * Events\n *  - **data** {function(item) {}} the data event triggers when a document is ready.\n *  - **end** {function() {}} the end event triggers when there is no more documents available.\n *  - **close** {function() {}} the close event triggers when the stream is closed.\n *  - **error** {function(err) {}} the error event triggers if an error happens.\n *\n * @class Represents a GridFS File Stream.\n * @param {Boolean} autoclose automatically close file when the stream reaches the end.\n * @param {GridStore} cursor a cursor object that the stream wraps.\n * @return {ReadStream}\n */\nfunction ReadStream(autoclose, gstore) {\n  if (!(this instanceof ReadStream)) return new ReadStream(autoclose, gstore);\n  Stream.call(this);\n\n  this.autoclose = !!autoclose;\n  this.gstore = gstore;\n\n  this.finalLength = gstore.length - gstore.position;\n  this.completedLength = 0;\n  this.currentChunkNumber = gstore.currentChunk.chunkNumber;\n\n  this.paused = false;\n  this.readable = true;\n  this.pendingChunk = null;\n  this.executing = false;  \n  this.destroyed = false;\n\n  // Calculate the number of chunks\n  this.numberOfChunks = Math.ceil(gstore.length/gstore.chunkSize);\n\n  // This seek start position inside the current chunk\n  this.seekStartPosition = gstore.position - (this.currentChunkNumber * gstore.chunkSize);\n  \n  var self = this;\n  processor(function() {\n    self._execute();\n  });\n};\n\n/**\n * Inherit from Stream\n * @ignore\n * @api private\n */\nReadStream.prototype.__proto__ = Stream.prototype;\n\n/**\n * Flag stating whether or not this stream is readable.\n */\nReadStream.prototype.readable;\n\n/**\n * Flag stating whether or not this stream is paused.\n */\nReadStream.prototype.paused;\n\n/**\n * @ignore\n * @api private\n */\nReadStream.prototype._execute = function() {\n  if(this.paused === true || this.readable === false) {\n    return;\n  }\n\n  var gstore = this.gstore;\n  var self = this;\n  // Set that we are executing\n  this.executing = true;\n\n  var last = false;\n  var toRead = 0;\n\n  if(gstore.currentChunk.chunkNumber >= (this.numberOfChunks - 1)) {\n    self.executing = false;    \n    last = true;    \n  }\n\n  // Data setup\n  var data = null;\n\n  // Read a slice (with seek set if none)\n  if(this.seekStartPosition > 0 && (gstore.currentChunk.length() - this.seekStartPosition) > 0) {\n    data = gstore.currentChunk.readSlice(gstore.currentChunk.length() - this.seekStartPosition);\n    this.seekStartPosition = 0;\n  } else {\n    data = gstore.currentChunk.readSlice(gstore.currentChunk.length());\n  }\n\n  var processNext = function() {\n    if(last === true) {\n      self.readable = false;\n      self.emit(\"end\");\n      \n      if(self.autoclose === true) {\n        if(gstore.mode[0] == \"w\") {\n          gstore.close(function(err, doc) {\n            if (err) {\n              self.emit(\"error\", err);\n              return;\n            }\n            self.readable = false;  \n            self.destroyed = true;        \n            self.emit(\"close\", doc);\n          });\n        } else {\n          self.readable = false;\n          self.destroyed = true;        \n          self.emit(\"close\");\n        }\n      }\n    } else {\n      gstore._nthChunk(gstore.currentChunk.chunkNumber + 1, function(err, chunk) {\n        if(err) {\n          self.readable = false;\n          if(self.listeners(\"error\").length > 0)\n            self.emit(\"error\", err);\n          self.executing = false;\n          return;\n        }\n\n        self.pendingChunk = chunk;\n        if(self.paused === true) {\n          self.executing = false;\n          return;\n        }\n\n        gstore.currentChunk = self.pendingChunk;\n        self._execute();        \n      });\n    }    \n  }\n\n  // Return the data\n  if(data != null && gstore.currentChunk.chunkNumber == self.currentChunkNumber) {\n    self.currentChunkNumber = self.currentChunkNumber + 1;\n    self.completedLength += data.length;\n    self.pendingChunk = null;\n    // Send the data\n    process.nextTick(function() {\n      self.emit(\"data\", data); \n      processNext();           \n    })\n  } else {\n    processNext();\n  }\n};\n\n/**\n * Pauses this stream, then no farther events will be fired.\n *\n * @ignore\n * @api public\n */\nReadStream.prototype.pause = function() {\n  if(!this.executing) {\n    this.paused = true;    \n  }\n};\n\n/**\n * Destroys the stream, then no farther events will be fired.\n *\n * @ignore\n * @api public\n */\nReadStream.prototype.destroy = function() {\n  if(this.destroyed) return;\n  this.destroyed = true;\n  this.readable = false;\n  // Emit close event\n  this.emit(\"close\");\n};\n\n/**\n * Resumes this stream.\n *\n * @ignore\n * @api public\n */\nReadStream.prototype.resume = function() {\n  if(this.paused === false || !this.readable) {\n    return;\n  }\n    \n  this.paused = false;\n  var self = this;\n  processor(function() {\n    self._execute();\n  });\n};\n\nexports.ReadStream = ReadStream;\n"}