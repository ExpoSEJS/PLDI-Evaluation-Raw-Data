{"8":[9,15,9,28],"9":[1,20,1,27],"10":[10,9,10,38],"16":[10,9,10,38],"17":[1,28,1,32],"18":[21,23,21,52],"24":[21,23,21,52],"25":[1,20,1,33],"26":[22,21,22,44],"32":[28,24,28,93],"33":[1,20,1,33],"34":[22,46,22,49],"40":[28,24,28,93],"41":[1,20,1,33],"48":[26,17,26,20],"49":[2,26,2,38],"50":[22,46,22,49],"56":[34,17,34,74],"57":[2,26,2,45],"58":[25,35,25,58],"64":[37,21,37,60],"65":[2,26,2,45],"66":[28,24,28,55],"72":[37,21,37,60],"73":[2,26,2,45],"74":[28,59,28,93],"80":[34,17,34,74],"81":[3,17,3,24],"82":[32,44,32,72],"88":[22,21,22,44],"89":[3,25,3,49],"90":[34,17,34,41],"97":[3,17,3,50],"98":[34,45,34,60],"105":[3,17,3,60],"106":[34,45,34,74],"113":[3,70,3,77],"114":[37,21,37,40],"121":[3,78,3,88],"129":[3,70,3,89],"137":[3,100,3,107],"145":[3,108,3,114],"153":[3,100,3,115],"161":[3,100,3,122],"169":[3,133,3,140],"177":[3,141,3,147],"185":[3,133,3,148],"193":[3,133,3,155],"201":[3,17,3,60],"209":[3,17,3,60],"217":[3,70,3,89],"225":[3,70,3,89],"233":[3,100,3,122],"241":[3,100,3,122],"249":[3,133,3,155],"257":[3,133,3,155],"265":[5,31,5,32],"273":[5,31,5,32],"281":[5,31,5,32],"289":[6,23,6,27],"297":[6,23,6,27],"305":[6,23,6,27],"313":[7,36,7,37],"321":[7,36,7,37],"329":[7,36,7,37],"337":[8,28,8,33],"345":[8,28,8,33],"353":[8,28,8,33],"361":[9,15,9,22],"369":[9,26,9,28],"377":[9,15,9,28],"385":[9,5,9,29],"393":[10,9,10,16],"401":[10,17,10,29],"409":[10,9,10,30],"417":[10,34,10,38],"425":[11,31,11,32],"433":[11,31,11,32],"441":[11,9,11,33],"449":[13,31,13,33],"457":[13,31,13,46],"465":[13,31,13,66],"467":[13,31,13,64],"473":[13,31,13,73],"481":[13,31,13,73],"489":[13,9,13,74],"497":[14,9,14,16],"505":[14,17,14,24],"513":[14,28,14,32],"521":[14,9,14,32],"529":[14,9,14,33],"537":[17,23,17,24],"545":[18,20,18,34],"553":[19,15,19,23],"561":[16,19,20,6],"569":[16,19,20,6],"577":[16,19,20,6],"585":[21,23,21,30],"593":[21,31,21,43],"601":[21,23,21,44],"609":[21,48,21,52],"617":[21,56,21,63],"625":[21,64,21,76],"633":[21,56,21,77],"641":[21,55,21,78],"649":[21,81,21,83],"657":[21,81,21,96],"665":[21,81,21,116],"667":[21,81,21,114],"673":[21,23,21,116],"681":[21,23,21,116],"689":[22,18,22,19],"697":[22,18,22,19],"705":[22,18,22,19],"713":[22,21,22,22],"721":[22,25,22,44],"737":[22,46,22,47],"745":[22,46,22,49],"761":[23,26,23,37],"769":[23,38,23,39],"777":[23,26,23,40],"785":[23,26,23,40],"793":[23,26,23,40],"801":[24,9,24,11],"809":[24,33,24,42],"817":[24,59,24,61],"825":[24,63,24,70],"833":[24,72,24,74],"841":[24,76,24,87],"849":[24,33,24,88],"851":[24,33,24,58],"857":[24,104,24,114],"865":[24,90,24,116],"873":[25,35,25,54],"881":[25,57,25,58],"889":[25,35,25,58],"897":[25,13,25,59],"905":[26,17,26,20],"913":[27,31,27,34],"921":[27,31,27,34],"929":[27,17,27,35],"937":[28,24,28,30],"945":[28,24,28,40],"953":[28,41,28,42],"961":[28,24,28,43],"969":[28,24,28,47],"977":[28,51,28,55],"985":[28,59,28,65],"993":[28,59,28,75],"1001":[28,76,28,77],"1009":[28,59,28,78],"1017":[28,59,28,85],"1025":[28,89,28,93],"1033":[29,31,29,36],"1041":[29,45,29,51],"1049":[29,45,29,61],"1057":[29,62,29,63],"1065":[29,45,29,64],"1073":[29,31,29,65],"1075":[29,31,29,44],"1081":[29,31,29,65],"1089":[29,17,29,66],"1097":[31,36,31,40],"1105":[31,36,31,40],"1113":[31,17,31,41],"1121":[32,44,32,68],"1129":[32,71,32,72],"1137":[32,44,32,72],"1145":[32,17,32,73],"1153":[34,17,34,36],"1161":[34,40,34,41],"1169":[34,52,34,60],"1177":[34,64,34,74],"1185":[35,40,35,48],"1193":[35,40,35,48],"1201":[35,40,35,48],"1209":[36,28,36,32],"1217":[36,28,36,32],"1225":[36,17,36,33],"1233":[37,21,37,32],"1241":[37,36,37,40],"1249":[37,44,37,60],"1257":[38,21,38,23],"1265":[38,21,38,36],"1273":[38,21,38,41],"1281":[38,46,38,60],"1289":[38,62,38,64],"1297":[38,62,38,77],"1305":[38,79,38,87],"1313":[38,89,38,97],"1321":[38,21,38,98],"1323":[38,21,38,45],"1329":[38,21,38,99],"1337":[39,21,39,37],"1345":[39,38,39,49],"1353":[39,51,39,55],"1361":[39,21,39,56],"1369":[39,21,39,57],"1377":[41,21,41,37],"1385":[41,38,41,49],"1393":[41,51,41,56],"1401":[41,21,41,57],"1409":[41,21,41,58],"1417":[24,118,44,10],"1425":[24,118,44,10],"1433":[24,118,44,10],"1441":[24,118,44,10],"1449":[24,118,44,10],"1457":[24,118,44,10],"1465":[24,9,44,11],"1467":[24,9,24,32],"1473":[24,9,44,12],"1481":[4,20,46,2],"1489":[4,20,46,2],"1497":[4,20,46,2],"1505":[4,20,46,2],"1513":[4,20,46,2],"1521":[4,20,46,2],"1529":[4,20,46,2],"1537":[4,20,46,2],"1545":[4,20,46,2],"1553":[4,20,46,2],"1561":[4,20,46,2],"1569":[4,20,46,2],"1577":[4,20,46,2],"1585":[4,20,46,2],"1593":[4,20,46,2],"1601":[4,20,46,2],"1609":[4,20,46,2],"1617":[4,20,46,2],"1625":[4,20,46,2],"1633":[47,1,47,8],"1641":[47,24,47,36],"1649":[47,1,47,36],"1657":[47,1,47,37],"1665":[1,1,47,37],"1673":[1,1,47,37],"1681":[1,1,47,37],"1689":[1,1,47,37],"1697":[1,1,47,37],"1705":[1,1,47,37],"1713":[1,1,47,37],"1721":[1,1,47,37],"1729":[10,5,15,6],"1737":[21,23,21,116],"1745":[28,20,33,14],"1753":[26,13,33,14],"1761":[37,17,42,18],"1769":[34,13,43,14],"1777":[24,118,44,10],"1785":[24,118,44,10],"1793":[22,5,45,6],"1801":[22,5,45,6],"1809":[4,20,46,2],"1817":[4,20,46,2],"1825":[1,1,47,37],"1833":[1,1,47,37],"nBranches":22,"originalCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/auth/mongodb_x509.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/auth/mongodb_x509_jalangi_.js","code":"var DbCommand = require('../commands/db_command').DbCommand\n  , utils = require('../utils')\n  , Binary = require('bson').Binary\n  , format = require('util').format;\n\nvar authenticate = function(db, username, password, options, callback, t) {\n  var numberOfConnections = 0;\n  var errorObject = null;\n  var numberOfValidConnections = 0;\n  var credentialsValid = false;\n  options = options || {};\n  \n  if(options['connection'] != null) {\n    //if a connection was explicitly passed on options, then we have only one...\n    numberOfConnections = 1;\n  } else {\n    // Get the amount of connections in the pool to ensure we have authenticated all comments\n    numberOfConnections = db.serverConfig.allRawConnections().length;\n    options['onAll'] = true;\n  }\n\n  // Let's start the sasl process\n  var command = {\n      authenticate: 1\n    , mechanism: 'MONGODB-X509'\n    , user: username\n  };\n\n  // Grab all the connections\n  var connections = options['connection'] != null ? [options['connection']] : db.serverConfig.allRawConnections();\n\n  // Authenticate all connections\n  for(var i = 0; i < numberOfConnections; i++) {\n    var connection = connections[i];\n    // Execute first sasl step\n    db._executeQueryCommand(DbCommand.createDbCommand(db, command, {}, '$external'), {connection:connection}, function(err, result) {\n      // Count down\n      numberOfConnections = numberOfConnections - 1;\n\n      // Ensure we save any error\n      if(err) {\n        errorObject = err;\n      } else if(result.documents[0].err != null || result.documents[0].errmsg != null){\n        errorObject = utils.toError(result.documents[0]);\n      } else {\n        credentialsValid = true;\n        numberOfValidConnections = numberOfValidConnections + 1;        \n      }\n\n      // Work around the case where the number of connections are 0\n      if(numberOfConnections <= 0 && typeof callback == 'function') {\n        var internalCallback = callback;\n        callback = null;\n\n        if(errorObject == null && credentialsValid) {\n          // We authenticated correctly save the credentials\n          db.serverConfig.auth.add('MONGODB-X509', db.databaseName, username, password);\n          // Return callback\n          internalCallback(errorObject, true);          \n        } else {\n          internalCallback(errorObject, false);\n        }\n      }\n    });\n  }\n}\n\nexports.authenticate = authenticate;"}