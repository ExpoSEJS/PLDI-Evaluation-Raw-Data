{"8":[16,15,16,28],"9":[1,20,1,27],"10":[17,9,17,25],"16":[17,9,17,25],"17":[1,28,1,32],"18":[19,9,19,38],"24":[19,9,19,38],"25":[1,20,1,33],"26":[27,21,27,44],"32":[25,29,25,70],"33":[1,20,1,33],"34":[27,46,27,49],"40":[30,17,30,20],"41":[1,20,1,33],"48":[36,17,36,74],"49":[2,26,2,38],"50":[27,46,27,49],"56":[42,28,42,107],"57":[2,26,2,45],"58":[29,35,29,58],"64":[42,28,42,127],"65":[2,26,2,45],"66":[34,44,34,72],"72":[42,28,42,127],"73":[2,26,2,45],"74":[36,17,36,41],"80":[39,21,39,40],"81":[3,17,3,24],"82":[36,45,36,60],"88":[36,17,36,74],"89":[3,25,3,49],"90":[36,45,36,74],"96":[27,21,27,44],"97":[3,17,3,50],"98":[39,21,39,40],"104":[61,13,61,16],"105":[3,17,3,60],"106":[42,28,42,56],"112":[65,17,65,20],"113":[3,70,3,77],"114":[42,60,42,107],"120":[68,21,68,24],"121":[3,78,3,88],"128":[76,25,76,28],"129":[3,70,3,89],"136":[80,29,80,32],"137":[3,100,3,107],"144":[88,33,88,36],"145":[3,108,3,114],"152":[98,41,98,44],"153":[3,100,3,115],"160":[101,41,101,49],"161":[3,100,3,122],"169":[3,17,3,60],"177":[3,17,3,60],"185":[3,70,3,89],"193":[3,70,3,89],"201":[3,100,3,122],"209":[3,100,3,122],"217":[4,16,4,20],"225":[4,16,4,20],"233":[4,16,4,20],"241":[5,24,5,28],"249":[5,24,5,28],"257":[5,24,5,28],"265":[7,16,7,23],"273":[7,24,7,34],"281":[7,16,7,35],"289":[7,16,7,44],"297":[7,16,7,44],"305":[7,5,7,45],"313":[8,24,8,31],"321":[8,32,8,42],"329":[8,24,8,43],"337":[8,24,8,53],"345":[8,24,8,70],"353":[8,24,8,70],"361":[8,5,8,71],"369":[9,3,10,2],"377":[12,31,12,32],"385":[12,31,12,32],"393":[12,31,12,32],"401":[13,23,13,27],"409":[13,23,13,27],"417":[13,23,13,27],"425":[14,36,14,37],"433":[14,36,14,37],"441":[14,36,14,37],"449":[15,28,15,33],"457":[15,28,15,33],"465":[15,28,15,33],"473":[16,15,16,22],"481":[16,26,16,28],"489":[16,15,16,28],"497":[16,5,16,29],"505":[17,9,17,17],"513":[17,21,17,25],"521":[18,16,18,24],"529":[18,29,18,34],"537":[18,35,18,70],"545":[18,25,18,71],"553":[18,16,18,72],"561":[18,16,18,72],"569":[18,9,18,73],"577":[19,9,19,16],"585":[19,17,19,29],"593":[19,9,19,30],"601":[19,34,19,38],"609":[20,31,20,32],"617":[20,31,20,32],"625":[20,9,20,33],"633":[22,31,22,33],"641":[22,31,22,46],"649":[22,31,22,66],"651":[22,31,22,64],"657":[22,31,22,73],"665":[22,31,22,73],"673":[22,9,22,74],"681":[23,9,23,16],"689":[23,17,23,24],"697":[23,28,23,32],"705":[23,9,23,32],"713":[23,9,23,33],"721":[25,29,25,36],"729":[25,37,25,56],"737":[25,29,25,57],"745":[25,61,25,70],"753":[25,29,25,70],"761":[25,29,25,70],"769":[26,23,26,25],"777":[26,23,26,38],"785":[26,23,26,58],"787":[26,23,26,56],"793":[26,23,26,58],"801":[26,23,26,58],"809":[27,18,27,19],"817":[27,18,27,19],"825":[27,18,27,19],"833":[27,21,27,22],"841":[27,25,27,44],"857":[27,46,27,47],"865":[27,46,27,49],"881":[28,9,28,25],"889":[28,26,28,28],"897":[28,30,28,38],"905":[28,40,28,48],"913":[28,50,28,56],"921":[28,58,28,75],"929":[28,77,28,88],"937":[28,89,28,90],"945":[28,77,28,91],"953":[29,35,29,54],"961":[29,57,29,58],"969":[29,35,29,58],"977":[29,13,29,59],"985":[30,17,30,20],"993":[31,31,31,34],"1001":[31,31,31,34],"1009":[31,17,31,35],"1017":[33,36,33,40],"1025":[33,36,33,40],"1033":[33,17,33,41],"1041":[34,44,34,68],"1049":[34,71,34,72],"1057":[34,44,34,72],"1065":[34,17,34,73],"1073":[36,17,36,36],"1081":[36,40,36,41],"1089":[36,52,36,60],"1097":[36,64,36,74],"1105":[37,40,37,48],"1113":[37,40,37,48],"1121":[37,40,37,48],"1129":[38,28,38,32],"1137":[38,28,38,32],"1145":[38,17,38,33],"1153":[39,21,39,32],"1161":[39,36,39,40],"1169":[40,21,40,23],"1177":[40,21,40,36],"1185":[40,21,40,41],"1193":[40,46,40,54],"1201":[40,56,40,58],"1209":[40,56,40,71],"1217":[40,73,40,81],"1225":[40,83,40,91],"1233":[40,93,40,99],"1241":[40,101,40,118],"1249":[40,21,40,119],"1251":[40,21,40,45],"1257":[40,21,40,120],"1265":[41,28,41,44],"1273":[41,45,41,49],"1281":[41,51,41,55],"1289":[41,28,41,56],"1297":[41,28,41,56],"1305":[41,21,41,57],"1313":[42,28,42,52],"1321":[42,55,42,56],"1329":[42,60,42,84],"1337":[42,88,42,107],"1345":[42,111,42,127],"1353":[43,21,43,23],"1361":[43,21,43,36],"1369":[43,21,43,41],"1377":[43,46,43,54],"1385":[43,56,43,58],"1393":[43,56,43,71],"1401":[43,73,43,81],"1409":[43,83,43,91],"1417":[43,93,43,99],"1425":[43,101,43,118],"1433":[43,21,43,119],"1435":[43,21,43,45],"1441":[43,21,43,120],"1449":[44,28,44,44],"1457":[44,45,44,49],"1465":[44,51,44,55],"1473":[44,28,44,56],"1481":[44,28,44,56],"1489":[44,21,44,57],"1497":[46,28,46,44],"1505":[46,45,46,56],"1513":[46,58,46,63],"1521":[46,28,46,64],"1529":[46,28,46,64],"1537":[46,21,46,65],"1545":[28,93,49,10],"1553":[28,93,49,10],"1561":[28,93,49,10],"1569":[28,93,49,10],"1577":[28,93,49,10],"1585":[28,93,49,10],"1593":[28,9,49,11],"1601":[28,9,49,12],"1609":[11,20,51,2],"1617":[11,20,51,2],"1625":[11,20,51,2],"1633":[11,20,51,2],"1641":[11,20,51,2],"1649":[11,20,51,2],"1657":[11,20,51,2],"1665":[11,20,51,2],"1673":[11,20,51,2],"1681":[11,20,51,2],"1689":[11,20,51,2],"1697":[11,20,51,2],"1705":[11,20,51,2],"1713":[11,20,51,2],"1721":[11,20,51,2],"1729":[11,20,51,2],"1737":[11,20,51,2],"1745":[11,20,51,2],"1753":[54,20,54,21],"1761":[55,20,55,28],"1769":[56,18,56,20],"1777":[57,24,57,25],"1785":[53,19,58,6],"1793":[53,19,58,6],"1801":[53,19,58,6],"1809":[59,34,59,50],"1817":[59,51,59,61],"1825":[59,51,59,75],"1833":[59,51,59,80],"1841":[59,82,59,92],"1849":[59,82,59,106],"1857":[59,82,59,111],"1865":[59,113,59,125],"1873":[59,30,59,126],"1881":[59,30,59,126],"1889":[59,30,59,126],"1897":[60,5,60,7],"1905":[60,29,60,38],"1913":[60,55,60,57],"1921":[60,59,60,66],"1929":[60,68,60,70],"1937":[60,72,60,83],"1945":[60,29,60,84],"1947":[60,29,60,54],"1953":[60,100,60,110],"1961":[60,86,60,112],"1969":[61,13,61,16],"1977":[62,20,62,28],"1985":[62,29,62,32],"1993":[62,20,62,33],"2001":[62,20,62,33],"2009":[62,13,62,34],"2017":[63,15,63,18],"2025":[63,15,63,28],"2033":[63,29,63,30],"2041":[63,15,63,31],"2049":[63,15,63,31],"2057":[63,9,63,32],"2065":[64,9,64,27],"2073":[64,33,64,41],"2081":[64,43,64,51],"2089":[65,17,65,20],"2097":[66,24,66,32],"2105":[66,33,66,36],"2113":[66,24,66,37],"2121":[66,24,66,37],"2129":[66,17,66,38],"2137":[67,13,67,31],"2145":[67,43,67,46],"2153":[67,43,67,54],"2161":[68,21,68,24],"2169":[69,28,69,36],"2177":[69,37,69,40],"2185":[69,28,69,41],"2193":[69,28,69,41],"2201":[69,21,69,42],"2209":[71,35,71,36],"2217":[72,37,72,40],"2225":[72,37,72,55],"2233":[73,30,73,37],"2241":[70,31,74,18],"2249":[70,31,74,18],"2257":[70,31,74,18],"2265":[75,17,75,19],"2273":[75,41,75,50],"2281":[75,67,75,69],"2289":[75,71,75,78],"2297":[75,80,75,82],"2305":[75,84,75,95],"2313":[75,41,75,96],"2315":[75,41,75,66],"2321":[75,112,75,122],"2329":[75,98,75,124],"2337":[76,25,76,28],"2345":[77,32,77,40],"2353":[77,41,77,44],"2361":[77,32,77,45],"2369":[77,32,77,45],"2377":[77,25,77,46],"2385":[78,27,78,30],"2393":[78,27,78,40],"2401":[78,41,78,42],"2409":[78,27,78,43],"2417":[78,27,78,43],"2425":[78,21,78,44],"2433":[79,21,79,39],"2441":[79,51,79,54],"2449":[79,51,79,62],"2457":[80,29,80,32],"2465":[81,36,81,44],"2473":[81,45,81,48],"2481":[81,36,81,49],"2489":[81,36,81,49],"2497":[81,29,81,50],"2505":[83,43,83,44],"2513":[84,45,84,48],"2521":[84,45,84,63],"2529":[85,38,85,45],"2537":[82,39,86,26],"2545":[82,39,86,26],"2553":[82,39,86,26],"2561":[87,25,87,27],"2569":[87,49,87,58],"2577":[87,75,87,77],"2585":[87,79,87,86],"2593":[87,88,87,90],"2601":[87,92,87,103],"2609":[87,49,87,104],"2611":[87,49,87,74],"2617":[87,120,87,130],"2625":[87,106,87,132],"2633":[88,33,88,36],"2641":[89,40,89,48],"2649":[89,49,89,52],"2657":[89,40,89,53],"2665":[89,40,89,53],"2673":[89,33,89,54],"2681":[90,35,90,38],"2689":[90,35,90,48],"2697":[90,49,90,50],"2705":[90,35,90,51],"2713":[90,35,90,51],"2721":[90,29,90,52],"2729":[91,29,91,47],"2737":[91,59,91,62],"2745":[91,59,91,70],"2753":[93,51,93,52],"2761":[94,53,94,56],"2769":[94,53,94,71],"2777":[95,46,95,53],"2785":[92,47,96,34],"2793":[92,47,96,34],"2801":[92,47,96,34],"2809":[97,33,97,35],"2817":[97,57,97,66],"2825":[97,83,97,85],"2833":[97,87,97,94],"2841":[97,96,97,98],"2849":[97,100,97,111],"2857":[97,57,97,112],"2859":[97,57,97,82],"2865":[97,128,97,138],"2873":[97,114,97,140],"2881":[98,41,98,44],"2889":[99,48,99,56],"2897":[99,57,99,60],"2905":[99,48,99,61],"2913":[99,48,99,61],"2921":[99,41,99,62],"2929":[100,43,100,46],"2937":[100,43,100,56],"2945":[100,57,100,58],"2953":[100,43,100,59],"2961":[100,43,100,59],"2969":[100,37,100,60],"2977":[101,41,101,44],"2985":[101,41,101,49],"2993":[102,48,102,56],"3001":[102,57,102,61],"3009":[102,63,102,67],"3017":[102,48,102,68],"3025":[102,48,102,68],"3033":[102,41,102,69],"3041":[103,37,103,45],"3049":[103,50,103,55],"3057":[103,56,103,79],"3065":[103,46,103,80],"3073":[103,82,103,87],"3081":[103,37,103,88],"3089":[103,37,103,89],"3097":[97,142,104,34],"3105":[97,142,104,34],"3113":[97,142,104,34],"3121":[97,142,104,34],"3129":[97,142,104,34],"3137":[97,33,104,35],"3139":[97,33,97,56],"3145":[97,33,104,36],"3153":[91,72,105,30],"3161":[91,72,105,30],"3169":[91,72,105,30],"3177":[91,72,105,30],"3185":[91,72,105,30],"3193":[91,72,105,30],"3201":[91,29,105,31],"3203":[91,29,91,58],"3209":[91,29,105,32],"3217":[87,134,106,26],"3225":[87,134,106,26],"3233":[87,134,106,26],"3241":[87,134,106,26],"3249":[87,134,106,26],"3257":[87,25,106,27],"3259":[87,25,87,48],"3265":[87,25,106,28],"3273":[79,64,107,22],"3281":[79,64,107,22],"3289":[79,64,107,22],"3297":[79,64,107,22],"3305":[79,64,107,22],"3313":[79,64,107,22],"3321":[79,21,107,23],"3323":[79,21,79,50],"3329":[79,21,107,24],"3337":[75,126,108,18],"3345":[75,126,108,18],"3353":[75,126,108,18],"3361":[75,126,108,18],"3369":[75,126,108,18],"3377":[75,17,108,19],"3379":[75,17,75,40],"3385":[75,17,108,20],"3393":[67,56,109,14],"3401":[67,56,109,14],"3409":[67,56,109,14],"3417":[67,56,109,14],"3425":[67,56,109,14],"3433":[67,56,109,14],"3441":[67,13,109,15],"3443":[67,13,67,42],"3449":[67,13,109,16],"3457":[64,53,110,10],"3465":[64,53,110,10],"3473":[64,53,110,10],"3481":[64,53,110,10],"3489":[64,9,110,11],"3491":[64,9,64,32],"3497":[64,9,110,12],"3505":[60,114,111,6],"3513":[60,114,111,6],"3521":[60,114,111,6],"3529":[60,114,111,6],"3537":[60,114,111,6],"3545":[60,5,111,7],"3547":[60,5,60,28],"3553":[60,5,111,8],"3561":[52,24,112,2],"3569":[52,24,112,2],"3577":[52,24,112,2],"3585":[52,24,112,2],"3593":[52,24,112,2],"3601":[52,24,112,2],"3609":[52,24,112,2],"3617":[52,24,112,2],"3625":[52,24,112,2],"3633":[52,24,112,2],"3641":[52,24,112,2],"3649":[52,24,112,2],"3657":[52,24,112,2],"3665":[52,24,112,2],"3673":[113,1,113,8],"3681":[113,24,113,36],"3689":[113,1,113,36],"3697":[113,1,113,37],"3705":[1,1,113,37],"3713":[1,1,113,37],"3721":[1,1,113,37],"3729":[1,1,113,37],"3737":[1,1,113,37],"3745":[1,1,113,37],"3753":[1,1,113,37],"3761":[1,1,113,37],"3769":[1,1,113,37],"3777":[1,1,113,37],"3785":[17,5,18,73],"3793":[19,5,24,6],"3801":[30,13,35,14],"3809":[42,24,47,18],"3817":[39,17,47,18],"3825":[36,13,48,14],"3833":[28,93,49,10],"3841":[28,93,49,10],"3849":[27,5,50,6],"3857":[27,5,50,6],"3865":[11,20,51,2],"3873":[11,20,51,2],"3881":[61,9,62,34],"3889":[65,13,66,38],"3897":[68,17,69,42],"3905":[76,21,77,46],"3913":[80,25,81,50],"3921":[88,29,89,54],"3929":[98,37,99,62],"3937":[101,37,102,69],"3945":[97,142,104,34],"3953":[97,142,104,34],"3961":[91,72,105,30],"3969":[91,72,105,30],"3977":[87,134,106,26],"3985":[87,134,106,26],"3993":[79,64,107,22],"4001":[79,64,107,22],"4009":[75,126,108,18],"4017":[75,126,108,18],"4025":[67,56,109,14],"4033":[67,56,109,14],"4041":[64,53,110,10],"4049":[64,53,110,10],"4057":[60,114,111,6],"4065":[60,114,111,6],"4073":[52,24,112,2],"4081":[52,24,112,2],"4089":[1,1,113,37],"4097":[1,1,113,37],"nBranches":40,"originalCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/auth/mongodb_sspi.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/harvesterjs/node_modules/harvesterjs/node_modules/mongojs/node_modules/mongodb/lib/mongodb/auth/mongodb_sspi_jalangi_.js","code":"var DbCommand = require('../commands/db_command').DbCommand\n  , utils = require('../utils')\n  , format = require('util').format;\n\n// Kerberos class\nvar Kerberos = null;\nvar MongoAuthProcess = null;\n// Try to grab the Kerberos class\ntry {\n  Kerberos = require('kerberos').Kerberos\n  // Authentication process for Mongo\n  MongoAuthProcess = require('kerberos').processes.MongoAuthProcess\n} catch(err) {}\n\nvar authenticate = function(db, username, password, authdb, options, callback) {\n  var numberOfConnections = 0;\n  var errorObject = null;  \n  var numberOfValidConnections = 0;\n  var credentialsValid = false;\n  options = options || {};\n\n  // We don't have the Kerberos library\n  if(Kerberos == null) return callback(new Error(\"Kerberos library is not installed\"));\n\n  if(options['connection'] != null) {\n    //if a connection was explicitly passed on options, then we have only one...\n    numberOfConnections = 1;\n  } else {\n    // Get the amount of connections in the pool to ensure we have authenticated all comments\n    numberOfConnections = db.serverConfig.allRawConnections().length;\n    options['onAll'] = true;\n  }\n\n  // Set the sspi server name\n  var gssapiServiceName = options['gssapiServiceName'] || 'mongodb';\n\n  // Grab all the connections\n  var connections = db.serverConfig.allRawConnections();\n  \n  // Authenticate all connections\n  for(var i = 0; i < numberOfConnections; i++) {\n    // Start Auth process for a connection\n    SSIPAuthenticate(db, username, password, authdb, gssapiServiceName, connections[i], function(err, result) {\n      // Adjust number of connections left to connect\n      numberOfConnections = numberOfConnections - 1;\n\n      // Ensure we save any error\n      if(err) { \n        errorObject = err;\n      } else {\n        credentialsValid = true;\n        numberOfValidConnections = numberOfValidConnections + 1;\n      }\n\n      // Work around the case where the number of connections are 0\n      if(numberOfConnections <= 0 && typeof callback == 'function') {\n        var internalCallback = callback;\n        callback = null;\n\n        if(errorObject == null) {\n          // We authenticated correctly save the credentials\n          db.serverConfig.auth.add('GSSAPI', db.databaseName, username, password, authdb, gssapiServiceName);\n          // Return valid callback\n          return internalCallback(null, true);          \n        } else if(numberOfValidConnections > 0 && numberOfValidConnections != numberOfConnections\n          && credentialsValid) {\n            // We authenticated correctly save the credentials\n            db.serverConfig.auth.add('GSSAPI', db.databaseName, username, password, authdb, gssapiServiceName);\n            // Return valid callback\n            return internalCallback(null, true);                    \n        } else {\n          return internalCallback(errorObject, false);\n        }\n      }\n    });    \n  }\n}\n\nvar SSIPAuthenticate = function(db, username, password, authdb, service_name, connection, callback) {\n  // --------------------------------------------------------------\n  // Async Version\n  // --------------------------------------------------------------\n  var command = {\n      saslStart: 1\n    , mechanism: 'GSSAPI'\n    , payload: ''\n    , autoAuthorize: 1\n  };\n\n  // Create authenticator\n  var mongo_auth_process = new MongoAuthProcess(connection.socketOptions.host, connection.socketOptions.port, service_name);\n\n  // Execute first sasl step\n  db._executeQueryCommand(DbCommand.createDbCommand(db, command, {}, '$external'), {connection:connection}, function(err, doc) {\n    if(err) return callback(err);\n    doc = doc.documents[0];\n\n    mongo_auth_process.init(username, password, function(err) {\n      if(err) return callback(err);\n\n      mongo_auth_process.transition(doc.payload, function(err, payload) {\n        if(err) return callback(err);\n\n        // Perform the next step against mongod\n        var command = {\n            saslContinue: 1\n          , conversationId: doc.conversationId\n          , payload: payload\n        };\n\n        // Execute the command\n        db._executeQueryCommand(DbCommand.createDbCommand(db, command, {}, '$external'), {connection:connection}, function(err, doc) {\n          if(err) return callback(err);\n          doc = doc.documents[0];\n\n          mongo_auth_process.transition(doc.payload, function(err, payload) {\n            if(err) return callback(err);\n\n            // Perform the next step against mongod\n            var command = {\n                saslContinue: 1\n              , conversationId: doc.conversationId\n              , payload: payload\n            };\n\n            // Execute the command\n            db._executeQueryCommand(DbCommand.createDbCommand(db, command, {}, '$external'), {connection:connection}, function(err, doc) {\n              if(err) return callback(err);\n              doc = doc.documents[0];\n              \n              mongo_auth_process.transition(doc.payload, function(err, payload) {\n                // Perform the next step against mongod\n                var command = {\n                    saslContinue: 1\n                  , conversationId: doc.conversationId\n                  , payload: payload\n                };\n\n                // Execute the command\n                db._executeQueryCommand(DbCommand.createDbCommand(db, command, {}, '$external'), {connection:connection}, function(err, doc) {\n                  if(err) return callback(err);\n                  doc = doc.documents[0];\n\n                  if(doc.done) return callback(null, true);\n                  callback(new Error(\"Authentication failed\"), false);\n                });        \n              });\n            });\n          });\n        });\n      });\n    });\n  });  \n}\n\nexports.authenticate = authenticate;"}