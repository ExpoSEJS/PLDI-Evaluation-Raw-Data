{"8":[11,12,11,70],"9":[1,20,1,27],"10":[11,12,11,33],"16":[11,12,11,107],"17":[1,28,1,32],"18":[11,37,11,70],"24":[20,9,20,19],"25":[1,20,1,33],"26":[11,74,11,107],"32":[40,28,40,46],"33":[1,20,1,33],"34":[20,9,20,19],"40":[38,28,38,44],"41":[1,20,1,33],"42":[25,12,25,34],"48":[36,21,36,24],"49":[2,26,2,38],"50":[35,25,35,34],"56":[46,21,46,63],"57":[2,26,2,45],"58":[44,48,44,76],"64":[50,25,50,44],"65":[2,26,2,45],"66":[46,21,46,31],"72":[49,28,49,38],"73":[2,26,2,45],"74":[46,35,46,63],"80":[46,21,46,63],"81":[3,1,3,13],"82":[49,28,49,38],"88":[25,12,25,34],"89":[3,1,3,14],"90":[50,25,50,44],"96":[62,13,62,40],"97":[4,9,4,16],"98":[61,21,61,41],"104":[61,21,61,41],"105":[4,17,4,23],"106":[61,43,61,46],"112":[67,9,67,15],"113":[4,9,4,24],"120":[72,9,72,19],"121":[4,9,4,31],"122":[61,43,61,46],"128":[77,17,77,27],"129":[4,42,4,49],"130":[67,9,67,15],"136":[74,21,74,46],"137":[4,50,4,58],"138":[72,9,72,19],"145":[4,42,4,59],"146":[74,21,74,46],"153":[4,70,4,77],"154":[74,48,74,51],"161":[4,78,4,84],"169":[4,70,4,85],"170":[74,48,74,51],"177":[4,70,4,92],"178":[76,21,76,30],"185":[4,107,4,114],"186":[77,17,77,27],"193":[4,115,4,125],"201":[4,107,4,126],"209":[4,9,4,31],"217":[4,9,4,31],"225":[4,42,4,59],"233":[4,42,4,59],"241":[4,70,4,92],"249":[4,70,4,92],"257":[4,107,4,126],"265":[4,107,4,126],"273":[6,5,6,9],"281":[6,15,6,17],"289":[6,5,6,17],"297":[6,5,6,18],"305":[7,5,7,9],"313":[7,21,7,29],"321":[7,5,7,29],"329":[7,5,7,30],"337":[8,5,8,9],"345":[8,21,8,29],"353":[8,5,8,29],"361":[8,5,8,30],"369":[5,19,9,2],"377":[5,19,9,2],"385":[5,19,9,2],"393":[5,19,9,2],"401":[5,19,9,2],"409":[5,19,9,2],"417":[5,19,9,2],"425":[5,19,9,2],"433":[10,1,10,12],"441":[10,1,10,22],"449":[11,12,11,19],"457":[11,12,11,22],"465":[11,26,11,30],"473":[11,26,11,33],"481":[11,37,11,44],"489":[11,37,11,53],"497":[11,57,11,61],"505":[11,57,11,70],"513":[11,74,11,81],"521":[11,74,11,90],"529":[11,94,11,98],"537":[11,94,11,107],"545":[11,12,11,107],"553":[11,5,11,108],"561":[10,31,12,2],"569":[10,31,12,2],"577":[10,31,12,2],"585":[10,31,12,2],"593":[10,1,12,2],"601":[10,1,12,3],"609":[14,5,14,9],"617":[14,22,14,24],"625":[14,5,14,24],"633":[14,5,14,25],"641":[13,13,15,2],"649":[13,13,15,2],"657":[13,13,15,2],"665":[13,13,15,2],"673":[13,13,15,2],"681":[16,1,16,6],"689":[16,1,16,16],"697":[17,16,17,20],"705":[17,16,17,20],"713":[17,16,17,20],"721":[18,23,18,27],"729":[18,23,18,36],"731":[18,23,18,34],"737":[18,23,18,36],"745":[18,23,18,36],"753":[19,17,19,28],"761":[19,17,19,35],"769":[19,17,19,35],"777":[19,17,19,35],"785":[20,9,20,14],"793":[20,18,20,19],"801":[21,16,21,24],"809":[21,25,21,29],"817":[21,31,21,35],"825":[21,16,21,36],"833":[21,16,21,36],"841":[21,9,21,37],"849":[22,36,22,37],"857":[22,36,22,37],"865":[22,36,22,37],"873":[23,28,23,33],"881":[23,28,23,33],"889":[23,28,23,33],"897":[24,23,24,27],"905":[24,23,24,27],"913":[24,23,24,27],"921":[25,12,25,23],"929":[25,12,25,30],"937":[25,33,25,34],"945":[27,31,27,37],"953":[27,38,27,39],"961":[27,40,27,50],"969":[27,52,27,60],"977":[27,62,27,70],"985":[27,38,27,71],"993":[27,27,27,72],"1001":[27,27,27,72],"1009":[27,27,27,72],"1017":[29,28,29,29],"1025":[30,28,30,35],"1033":[31,26,31,33],"1041":[32,32,32,33],"1049":[28,27,33,14],"1057":[28,27,33,14],"1065":[28,27,33,14],"1073":[34,13,34,19],"1081":[34,28,34,44],"1089":[34,46,34,53],"1097":[34,69,34,79],"1105":[34,55,34,81],"1113":[35,25,35,30],"1121":[35,33,35,34],"1129":[35,25,35,34],"1137":[35,17,35,35],"1145":[36,21,36,24],"1153":[37,35,37,38],"1161":[37,35,37,38],"1169":[37,21,37,39],"1177":[38,28,38,29],"1185":[38,28,38,36],"1193":[38,37,38,43],"1201":[38,28,38,44],"1209":[39,35,39,36],"1217":[39,35,39,43],"1225":[39,35,39,43],"1233":[39,21,39,44],"1241":[40,28,40,29],"1249":[40,28,40,36],"1257":[40,37,40,45],"1265":[40,28,40,46],"1273":[41,35,41,36],"1281":[41,35,41,43],"1289":[41,35,41,43],"1297":[41,21,41,44],"1305":[43,40,43,44],"1313":[43,40,43,44],"1321":[43,21,43,45],"1329":[44,48,44,72],"1337":[44,75,44,76],"1345":[44,48,44,76],"1353":[44,21,44,77],"1361":[46,21,46,26],"1369":[46,30,46,31],"1377":[46,35,46,59],"1385":[46,62,46,63],"1393":[47,21,47,35],"1401":[47,36,47,40],"1409":[47,36,47,50],"1417":[47,56,47,67],"1425":[47,68,47,70],"1433":[47,72,47,80],"1441":[47,82,47,90],"1449":[47,52,47,91],"1457":[47,21,47,92],"1465":[47,21,47,93],"1473":[48,21,48,29],"1481":[48,30,48,34],"1489":[48,36,48,40],"1497":[48,21,48,41],"1505":[48,21,48,42],"1513":[49,28,49,33],"1521":[49,37,49,38],"1529":[50,25,50,36],"1537":[50,40,50,44],"1545":[51,43,51,53],"1553":[51,54,51,55],"1561":[51,56,51,94],"1569":[51,54,51,95],"1577":[51,39,51,96],"1585":[51,39,51,96],"1593":[51,25,51,97],"1601":[52,21,52,29],"1609":[52,30,52,41],"1617":[52,43,52,48],"1625":[52,21,52,49],"1633":[52,21,52,50],"1641":[34,83,54,14],"1649":[34,83,54,14],"1657":[34,83,54,14],"1665":[34,83,54,14],"1673":[34,83,54,14],"1681":[34,13,54,15],"1683":[34,13,34,27],"1689":[34,13,54,16],"1697":[26,23,55,10],"1705":[26,23,55,10],"1713":[26,23,55,10],"1721":[26,23,55,10],"1729":[26,23,55,10],"1737":[26,23,55,10],"1745":[26,23,55,10],"1753":[26,23,55,10],"1761":[56,9,56,16],"1769":[56,17,56,28],"1777":[56,17,56,36],"1779":[56,17,56,34],"1785":[56,9,56,37],"1793":[56,9,56,38],"1801":[16,24,58,2],"1809":[16,24,58,2],"1817":[16,24,58,2],"1825":[16,24,58,2],"1833":[16,24,58,2],"1841":[16,24,58,2],"1849":[16,24,58,2],"1857":[16,24,58,2],"1865":[16,24,58,2],"1873":[16,24,58,2],"1881":[16,24,58,2],"1889":[16,24,58,2],"1897":[16,24,58,2],"1905":[16,24,58,2],"1913":[16,24,58,2],"1921":[16,24,58,2],"1929":[16,1,58,2],"1937":[16,1,58,3],"1945":[60,17,60,22],"1953":[60,17,60,22],"1961":[60,17,60,22],"1969":[61,18,61,19],"1977":[61,18,61,19],"1985":[61,18,61,19],"1993":[61,21,61,22],"2001":[61,25,61,34],"2009":[61,25,61,41],"2025":[61,43,61,44],"2033":[61,43,61,46],"2049":[62,13,62,22],"2057":[62,23,62,24],"2065":[62,13,62,25],"2073":[62,32,62,39],"2081":[62,13,62,40],"2083":[62,13,62,31],"2089":[63,21,63,25],"2097":[63,21,63,25],"2105":[63,13,63,26],"2113":[67,10,67,15],"2121":[68,9,68,18],"2129":[68,24,68,31],"2137":[68,9,68,32],"2139":[68,9,68,23],"2145":[68,9,68,33],"2153":[59,22,69,2],"2161":[59,22,69,2],"2169":[59,22,69,2],"2177":[59,22,69,2],"2185":[59,22,69,2],"2193":[59,22,69,2],"2201":[59,22,69,2],"2209":[59,22,69,2],"2217":[59,22,69,2],"2225":[70,1,70,6],"2233":[70,1,70,16],"2241":[71,17,71,21],"2249":[71,17,71,31],"2257":[71,17,71,38],"2265":[71,17,71,38],"2273":[71,17,71,38],"2281":[72,9,72,14],"2289":[72,18,72,19],"2297":[73,16,73,24],"2305":[73,25,73,29],"2313":[73,31,73,35],"2321":[73,16,73,36],"2329":[73,16,73,36],"2337":[73,9,73,37],"2345":[74,18,74,19],"2353":[74,18,74,19],"2361":[74,18,74,19],"2369":[74,21,74,22],"2377":[74,25,74,29],"2385":[74,25,74,39],"2393":[74,25,74,46],"2409":[74,48,74,49],"2417":[74,48,74,51],"2433":[75,9,75,13],"2441":[75,19,75,25],"2449":[75,27,75,31],"2457":[75,33,75,37],"2465":[75,33,75,47],"2473":[75,48,75,49],"2481":[75,33,75,50],"2489":[75,33,75,53],"2497":[75,55,75,59],"2505":[75,55,75,69],"2513":[75,70,75,71],"2521":[75,55,75,72],"2529":[75,55,75,81],"2537":[75,83,75,87],"2545":[75,83,75,97],"2553":[75,98,75,99],"2561":[75,83,75,100],"2569":[75,83,75,109],"2577":[76,21,76,26],"2585":[76,29,76,30],"2593":[76,21,76,30],"2601":[76,13,76,31],"2609":[77,17,77,22],"2617":[77,26,77,27],"2625":[78,17,78,25],"2633":[78,26,78,30],"2641":[78,32,78,36],"2649":[78,17,78,37],"2657":[78,17,78,38],"2665":[75,111,80,10],"2673":[75,111,80,10],"2681":[75,111,80,10],"2689":[75,111,80,10],"2697":[75,111,80,10],"2705":[75,9,80,11],"2707":[75,9,75,18],"2713":[75,9,80,12],"2721":[70,34,82,2],"2729":[70,34,82,2],"2737":[70,34,82,2],"2745":[70,34,82,2],"2753":[70,34,82,2],"2761":[70,34,82,2],"2769":[70,34,82,2],"2777":[70,34,82,2],"2785":[70,1,82,2],"2793":[70,1,82,3],"2801":[83,1,83,7],"2809":[83,18,83,23],"2817":[83,1,83,23],"2825":[83,1,83,24],"2833":[1,1,83,24],"2841":[1,1,83,24],"2849":[1,1,83,24],"2857":[1,1,83,24],"2865":[1,1,83,24],"2873":[1,1,83,24],"2881":[1,1,83,24],"2889":[1,1,83,24],"2897":[1,1,83,24],"2905":[1,1,83,24],"2913":[5,19,9,2],"2921":[5,19,9,2],"2929":[10,31,12,2],"2937":[10,31,12,2],"2945":[13,13,15,2],"2953":[13,13,15,2],"2961":[20,5,21,37],"2969":[40,24,45,18],"2977":[38,24,45,18],"2985":[36,17,45,18],"2993":[50,21,51,97],"3001":[49,24,53,18],"3009":[46,17,53,18],"3017":[34,83,54,14],"3025":[34,83,54,14],"3033":[26,23,55,10],"3041":[26,23,55,10],"3049":[25,5,57,6],"3057":[16,24,58,2],"3065":[16,24,58,2],"3073":[62,9,65,10],"3081":[61,5,66,6],"3089":[61,5,66,6],"3097":[67,5,68,33],"3105":[59,22,69,2],"3113":[59,22,69,2],"3121":[72,5,73,37],"3129":[77,13,79,14],"3137":[75,111,80,10],"3145":[75,111,80,10],"3153":[74,5,81,6],"3161":[74,5,81,6],"3169":[70,34,82,2],"3177":[70,34,82,2],"3185":[1,1,83,24],"3193":[1,1,83,24],"nBranches":34,"originalCodeFileName":"/home/blake/ExpoSE/Targets/node-flarum/node_modules/mongodb-core/lib/auth/plain.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/node-flarum/node_modules/mongodb-core/lib/auth/plain_jalangi_.js","code":"\"use strict\";\n\nvar f = require('util').format\n  , crypto = require('crypto')\n  , Binary = require('bson').Binary\n  , MongoError = require('../error');\n\nvar AuthSession = function(db, username, password) {\n  this.db = db;\n  this.username = username;\n  this.password = password;\n}\n\nAuthSession.prototype.equal = function(session) {\n  return session.db == this.db \n    && session.username == this.username\n    && session.password == this.password;\n}\n\n/**\n * Creates a new Plain authentication mechanism\n * @class\n * @return {Plain} A cursor instance\n */\nvar Plain = function() {\n  this.authStore = [];\n}\n\n/**\n * Authenticate\n * @method\n * @param {{Server}|{ReplSet}|{Mongos}} server Topology the authentication method is being called on\n * @param {Pool} pool Connection pool for this topology\n * @param {string} db Name of the database\n * @param {string} username Username\n * @param {string} password Password\n * @param {authResultCallback} callback The callback to return the result from the authentication\n * @return {object}\n */\nPlain.prototype.auth = function(server, pool, db, username, password, callback) {\n  var self = this;\n  // Get all the connections\n  var connections = pool.getAll();\n  // Total connections\n  var count = connections.length;\n  if(count == 0) return callback(null, null);\n\n  // Valid connections\n  var numberOfValidConnections = 0;\n  var credentialsValid = false;\n  var errorObject = null;\n\n  // For each connection we need to authenticate\n  while(connections.length > 0) {    \n    // Execute MongoCR\n    var execute = function(connection) {\n      // Create payload\n      var payload = new Binary(f(\"\\x00%s\\x00%s\", username, password));\n\n      // Let's start the sasl process\n      var command = {\n          saslStart: 1\n        , mechanism: 'PLAIN'\n        , payload: payload\n        , autoAuthorize: 1\n      };\n\n      // Let's start the process\n      server.command(\"$external.$cmd\"\n        , command\n        , { connection: connection }, function(err, r) {\n        // Adjust count\n        count = count - 1;\n\n        // If we have an error\n        if(err) {\n          errorObject = err;\n        } else if(r.result['$err']) {\n          errorObject = r.result;\n        } else if(r.result['errmsg']) {\n          errorObject = r.result;\n        } else {\n          credentialsValid = true;\n          numberOfValidConnections = numberOfValidConnections + 1;\n        }\n\n        // We have authenticated all connections\n        if(count == 0 && numberOfValidConnections > 0) {\n          // Store the auth details\n          addAuthSession(self.authStore, new AuthSession(db, username, password));\n          // Return correct authentication\n          callback(null, true);\n        } else if(count == 0) {\n          if(errorObject == null) errorObject = new MongoError(f(\"failed to authenticate using mongocr\"));\n          callback(errorObject, false);\n        }\n      });\n    }\n\n    // Get the connection\n    execute(connections.shift());\n  }\n}\n\n// Add to store only if it does not exist\nvar addAuthSession = function(authStore, session) {\n  var found = false;\n\n  for(var i = 0; i < authStore.length; i++) {\n    if(authStore[i].equal(session)) {\n      found = true;\n      break;\n    }\n  }\n\n  if(!found) authStore.push(session);\n}\n\n/**\n * Re authenticate pool\n * @method\n * @param {{Server}|{ReplSet}|{Mongos}} server Topology the authentication method is being called on\n * @param {Pool} pool Connection pool for this topology\n * @param {authResultCallback} callback The callback to return the result from the authentication\n * @return {object}\n */\nPlain.prototype.reauthenticate = function(server, pool, callback) {\n  var count = this.authStore.length;\n  if(count == 0) return callback(null, null);\n  // Iterate over all the auth details stored\n  for(var i = 0; i < this.authStore.length; i++) {\n    this.auth(server, pool, this.authStore[i].db, this.authStore[i].username, this.authStore[i].password, function(err, r) {\n      count = count - 1;\n      // Done re-authenticating\n      if(count == 0) {\n        callback(null, null);\n      }\n    });\n  }\n}\n\n/**\n * This is a result from a authentication strategy\n *\n * @callback authResultCallback\n * @param {error} error An error object. Set to null if no error present\n * @param {boolean} result The result of the authentication process\n */\n\nmodule.exports = Plain;"}