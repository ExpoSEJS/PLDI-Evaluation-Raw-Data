{"8":[11,12,11,70],"9":[1,20,1,27],"10":[11,12,11,33],"16":[11,12,11,107],"17":[1,28,1,32],"18":[11,37,11,70],"24":[20,9,20,19],"25":[1,20,1,33],"26":[11,74,11,107],"32":[38,28,38,46],"33":[1,20,1,33],"34":[20,9,20,19],"40":[36,28,36,44],"41":[1,20,1,33],"42":[25,12,25,34],"48":[34,21,34,24],"49":[2,26,2,38],"50":[33,25,33,34],"56":[44,21,44,63],"57":[2,26,2,45],"58":[42,48,42,76],"64":[48,25,48,44],"65":[2,26,2,45],"66":[44,21,44,31],"72":[47,28,47,38],"73":[2,26,2,45],"74":[44,35,44,63],"80":[44,21,44,63],"81":[3,1,3,13],"82":[47,28,47,38],"88":[25,12,25,34],"89":[3,1,3,14],"90":[48,25,48,44],"96":[60,13,60,40],"97":[4,9,4,16],"98":[59,21,59,41],"104":[59,21,59,41],"105":[4,17,4,23],"106":[59,43,59,46],"112":[65,9,65,15],"113":[4,9,4,24],"120":[70,9,70,19],"121":[4,9,4,31],"122":[59,43,59,46],"128":[75,17,75,27],"129":[4,42,4,49],"130":[65,9,65,15],"136":[72,21,72,46],"137":[4,50,4,58],"138":[70,9,70,19],"145":[4,42,4,59],"146":[72,21,72,46],"153":[4,74,4,81],"154":[72,48,72,51],"161":[4,82,4,92],"169":[4,74,4,93],"170":[72,48,72,51],"177":[4,9,4,31],"178":[74,21,74,30],"185":[4,9,4,31],"186":[75,17,75,27],"193":[4,42,4,59],"201":[4,42,4,59],"209":[4,74,4,93],"217":[4,74,4,93],"225":[6,5,6,9],"233":[6,15,6,17],"241":[6,5,6,17],"249":[6,5,6,18],"257":[7,5,7,9],"265":[7,21,7,29],"273":[7,5,7,29],"281":[7,5,7,30],"289":[8,5,8,9],"297":[8,21,8,29],"305":[8,5,8,29],"313":[8,5,8,30],"321":[5,19,9,2],"329":[5,19,9,2],"337":[5,19,9,2],"345":[5,19,9,2],"353":[5,19,9,2],"361":[5,19,9,2],"369":[5,19,9,2],"377":[5,19,9,2],"385":[10,1,10,12],"393":[10,1,10,22],"401":[11,12,11,19],"409":[11,12,11,22],"417":[11,26,11,30],"425":[11,26,11,33],"433":[11,37,11,44],"441":[11,37,11,53],"449":[11,57,11,61],"457":[11,57,11,70],"465":[11,74,11,81],"473":[11,74,11,90],"481":[11,94,11,98],"489":[11,94,11,107],"497":[11,12,11,107],"505":[11,5,11,108],"513":[10,31,12,2],"521":[10,31,12,2],"529":[10,31,12,2],"537":[10,31,12,2],"545":[10,1,12,2],"553":[10,1,12,3],"561":[14,5,14,9],"569":[14,22,14,24],"577":[14,5,14,24],"585":[14,5,14,25],"593":[13,12,15,2],"601":[13,12,15,2],"609":[13,12,15,2],"617":[13,12,15,2],"625":[13,12,15,2],"633":[16,1,16,5],"641":[16,1,16,15],"649":[17,16,17,20],"657":[17,16,17,20],"665":[17,16,17,20],"673":[18,23,18,27],"681":[18,23,18,36],"683":[18,23,18,34],"689":[18,23,18,36],"697":[18,23,18,36],"705":[19,17,19,28],"713":[19,17,19,35],"721":[19,17,19,35],"729":[19,17,19,35],"737":[20,9,20,14],"745":[20,18,20,19],"753":[21,16,21,24],"761":[21,25,21,29],"769":[21,31,21,35],"777":[21,16,21,36],"785":[21,16,21,36],"793":[21,9,21,37],"801":[22,36,22,37],"809":[22,36,22,37],"817":[22,36,22,37],"825":[23,28,23,33],"833":[23,28,23,33],"841":[23,28,23,33],"849":[24,23,24,27],"857":[24,23,24,27],"865":[24,23,24,27],"873":[25,12,25,23],"881":[25,12,25,30],"889":[25,33,25,34],"897":[28,31,28,32],"905":[29,28,29,42],"913":[30,23,30,31],"921":[27,27,31,14],"929":[27,27,31,14],"937":[27,27,31,14],"945":[32,13,32,19],"953":[32,28,32,44],"961":[32,46,32,53],"969":[32,69,32,79],"977":[32,55,32,81],"985":[33,25,33,30],"993":[33,33,33,34],"1001":[33,25,33,34],"1009":[33,17,33,35],"1017":[34,21,34,24],"1025":[35,35,35,38],"1033":[35,35,35,38],"1041":[35,21,35,39],"1049":[36,28,36,29],"1057":[36,28,36,36],"1065":[36,37,36,43],"1073":[36,28,36,44],"1081":[37,35,37,36],"1089":[37,35,37,43],"1097":[37,35,37,43],"1105":[37,21,37,44],"1113":[38,28,38,29],"1121":[38,28,38,36],"1129":[38,37,38,45],"1137":[38,28,38,46],"1145":[39,35,39,36],"1153":[39,35,39,43],"1161":[39,35,39,43],"1169":[39,21,39,44],"1177":[41,40,41,44],"1185":[41,40,41,44],"1193":[41,21,41,45],"1201":[42,48,42,72],"1209":[42,75,42,76],"1217":[42,48,42,76],"1225":[42,21,42,77],"1233":[44,21,44,26],"1241":[44,30,44,31],"1249":[44,35,44,59],"1257":[44,62,44,63],"1265":[45,21,45,35],"1273":[45,36,45,40],"1281":[45,36,45,50],"1289":[45,56,45,67],"1297":[45,68,45,70],"1305":[45,72,45,80],"1313":[45,82,45,90],"1321":[45,52,45,91],"1329":[45,21,45,92],"1337":[45,21,45,93],"1345":[46,21,46,29],"1353":[46,30,46,34],"1361":[46,36,46,40],"1369":[46,21,46,41],"1377":[46,21,46,42],"1385":[47,28,47,33],"1393":[47,37,47,38],"1401":[48,25,48,36],"1409":[48,40,48,44],"1417":[49,43,49,53],"1425":[49,54,49,55],"1433":[49,56,49,94],"1441":[49,54,49,95],"1449":[49,39,49,96],"1457":[49,39,49,96],"1465":[49,25,49,97],"1473":[50,21,50,29],"1481":[50,30,50,41],"1489":[50,43,50,48],"1497":[50,21,50,49],"1505":[50,21,50,50],"1513":[32,83,52,14],"1521":[32,83,52,14],"1529":[32,83,52,14],"1537":[32,83,52,14],"1545":[32,83,52,14],"1553":[32,13,52,15],"1555":[32,13,32,27],"1561":[32,13,52,16],"1569":[26,23,53,10],"1577":[26,23,53,10],"1585":[26,23,53,10],"1593":[26,23,53,10],"1601":[26,23,53,10],"1609":[26,23,53,10],"1617":[26,23,53,10],"1625":[54,9,54,16],"1633":[54,17,54,28],"1641":[54,17,54,36],"1643":[54,17,54,34],"1649":[54,9,54,37],"1657":[54,9,54,38],"1665":[16,23,56,2],"1673":[16,23,56,2],"1681":[16,23,56,2],"1689":[16,23,56,2],"1697":[16,23,56,2],"1705":[16,23,56,2],"1713":[16,23,56,2],"1721":[16,23,56,2],"1729":[16,23,56,2],"1737":[16,23,56,2],"1745":[16,23,56,2],"1753":[16,23,56,2],"1761":[16,23,56,2],"1769":[16,23,56,2],"1777":[16,23,56,2],"1785":[16,23,56,2],"1793":[16,1,56,2],"1801":[16,1,56,3],"1809":[58,17,58,22],"1817":[58,17,58,22],"1825":[58,17,58,22],"1833":[59,18,59,19],"1841":[59,18,59,19],"1849":[59,18,59,19],"1857":[59,21,59,22],"1865":[59,25,59,34],"1873":[59,25,59,41],"1889":[59,43,59,44],"1897":[59,43,59,46],"1913":[60,13,60,22],"1921":[60,23,60,24],"1929":[60,13,60,25],"1937":[60,32,60,39],"1945":[60,13,60,40],"1947":[60,13,60,31],"1953":[61,21,61,25],"1961":[61,21,61,25],"1969":[61,13,61,26],"1977":[65,10,65,15],"1985":[66,9,66,18],"1993":[66,24,66,31],"2001":[66,9,66,32],"2003":[66,9,66,23],"2009":[66,9,66,33],"2017":[57,22,67,2],"2025":[57,22,67,2],"2033":[57,22,67,2],"2041":[57,22,67,2],"2049":[57,22,67,2],"2057":[57,22,67,2],"2065":[57,22,67,2],"2073":[57,22,67,2],"2081":[57,22,67,2],"2089":[68,1,68,5],"2097":[68,1,68,15],"2105":[69,17,69,21],"2113":[69,17,69,31],"2121":[69,17,69,38],"2129":[69,17,69,38],"2137":[69,17,69,38],"2145":[70,9,70,14],"2153":[70,18,70,19],"2161":[71,16,71,24],"2169":[71,25,71,29],"2177":[71,31,71,35],"2185":[71,16,71,36],"2193":[71,16,71,36],"2201":[71,9,71,37],"2209":[72,18,72,19],"2217":[72,18,72,19],"2225":[72,18,72,19],"2233":[72,21,72,22],"2241":[72,25,72,29],"2249":[72,25,72,39],"2257":[72,25,72,46],"2273":[72,48,72,49],"2281":[72,48,72,51],"2297":[73,9,73,13],"2305":[73,19,73,25],"2313":[73,27,73,31],"2321":[73,33,73,37],"2329":[73,33,73,47],"2337":[73,48,73,49],"2345":[73,33,73,50],"2353":[73,33,73,53],"2361":[73,55,73,59],"2369":[73,55,73,69],"2377":[73,70,73,71],"2385":[73,55,73,72],"2393":[73,55,73,81],"2401":[73,83,73,87],"2409":[73,83,73,97],"2417":[73,98,73,99],"2425":[73,83,73,100],"2433":[73,83,73,109],"2441":[74,21,74,26],"2449":[74,29,74,30],"2457":[74,21,74,30],"2465":[74,13,74,31],"2473":[75,17,75,22],"2481":[75,26,75,27],"2489":[76,17,76,25],"2497":[76,26,76,30],"2505":[76,32,76,36],"2513":[76,17,76,37],"2521":[76,17,76,38],"2529":[73,111,78,10],"2537":[73,111,78,10],"2545":[73,111,78,10],"2553":[73,111,78,10],"2561":[73,111,78,10],"2569":[73,9,78,11],"2571":[73,9,73,18],"2577":[73,9,78,12],"2585":[68,33,80,2],"2593":[68,33,80,2],"2601":[68,33,80,2],"2609":[68,33,80,2],"2617":[68,33,80,2],"2625":[68,33,80,2],"2633":[68,33,80,2],"2641":[68,33,80,2],"2649":[68,1,80,2],"2657":[68,1,80,3],"2665":[81,1,81,7],"2673":[81,18,81,22],"2681":[81,1,81,22],"2689":[81,1,81,23],"2697":[1,1,81,23],"2705":[1,1,81,23],"2713":[1,1,81,23],"2721":[1,1,81,23],"2729":[1,1,81,23],"2737":[1,1,81,23],"2745":[1,1,81,23],"2753":[1,1,81,23],"2761":[1,1,81,23],"2769":[5,19,9,2],"2777":[5,19,9,2],"2785":[10,31,12,2],"2793":[10,31,12,2],"2801":[13,12,15,2],"2809":[13,12,15,2],"2817":[20,5,21,37],"2825":[38,24,43,18],"2833":[36,24,43,18],"2841":[34,17,43,18],"2849":[48,21,49,97],"2857":[47,24,51,18],"2865":[44,17,51,18],"2873":[32,83,52,14],"2881":[32,83,52,14],"2889":[26,23,53,10],"2897":[26,23,53,10],"2905":[25,5,55,6],"2913":[16,23,56,2],"2921":[16,23,56,2],"2929":[60,9,63,10],"2937":[59,5,64,6],"2945":[59,5,64,6],"2953":[65,5,66,33],"2961":[57,22,67,2],"2969":[57,22,67,2],"2977":[70,5,71,37],"2985":[75,13,77,14],"2993":[73,111,78,10],"3001":[73,111,78,10],"3009":[72,5,79,6],"3017":[72,5,79,6],"3025":[68,33,80,2],"3033":[68,33,80,2],"3041":[1,1,81,23],"3049":[1,1,81,23],"nBranches":34,"originalCodeFileName":"/home/blake/ExpoSE/Targets/node-flarum/node_modules/mongodb-core/lib/auth/x509.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/node-flarum/node_modules/mongodb-core/lib/auth/x509_jalangi_.js","code":"\"use strict\";\n\nvar f = require('util').format\n  , crypto = require('crypto')\n  , MongoError = require('../error');\n\nvar AuthSession = function(db, username, password) {\n  this.db = db;\n  this.username = username;\n  this.password = password;\n}\n\nAuthSession.prototype.equal = function(session) {\n  return session.db == this.db \n    && session.username == this.username\n    && session.password == this.password;\n}\n\n/**\n * Creates a new X509 authentication mechanism\n * @class\n * @return {X509} A cursor instance\n */\nvar X509 = function() {\n  this.authStore = [];\n}\n\n/**\n * Authenticate\n * @method\n * @param {{Server}|{ReplSet}|{Mongos}} server Topology the authentication method is being called on\n * @param {Pool} pool Connection pool for this topology\n * @param {string} db Name of the database\n * @param {string} username Username\n * @param {string} password Password\n * @param {authResultCallback} callback The callback to return the result from the authentication\n * @return {object}\n */\nX509.prototype.auth = function(server, pool, db, username, password, callback) {\n  var self = this;\n  // Get all the connections\n  var connections = pool.getAll();\n  // Total connections\n  var count = connections.length;\n  if(count == 0) return callback(null, null);\n\n  // Valid connections\n  var numberOfValidConnections = 0;\n  var credentialsValid = false;\n  var errorObject = null;\n\n  // For each connection we need to authenticate\n  while(connections.length > 0) {    \n    // Execute MongoCR\n    var execute = function(connection) {\n      // Let's start the sasl process\n      var command = {\n          authenticate: 1\n        , mechanism: 'MONGODB-X509'\n        , user: username\n      };\n\n      // Let's start the process\n      server.command(\"$external.$cmd\"\n        , command\n        , { connection: connection }, function(err, r) {\n        // Adjust count\n        count = count - 1;\n\n        // If we have an error\n        if(err) {\n          errorObject = err;\n        } else if(r.result['$err']) {\n          errorObject = r.result;\n        } else if(r.result['errmsg']) {\n          errorObject = r.result;\n        } else {\n          credentialsValid = true;\n          numberOfValidConnections = numberOfValidConnections + 1;\n        }\n\n        // We have authenticated all connections\n        if(count == 0 && numberOfValidConnections > 0) {\n          // Store the auth details\n          addAuthSession(self.authStore, new AuthSession(db, username, password));\n          // Return correct authentication\n          callback(null, true);\n        } else if(count == 0) {\n          if(errorObject == null) errorObject = new MongoError(f(\"failed to authenticate using mongocr\"));\n          callback(errorObject, false);\n        }\n      });\n    }\n\n    // Get the connection\n    execute(connections.shift());\n  }\n}\n\n// Add to store only if it does not exist\nvar addAuthSession = function(authStore, session) {\n  var found = false;\n\n  for(var i = 0; i < authStore.length; i++) {\n    if(authStore[i].equal(session)) {\n      found = true;\n      break;\n    }\n  }\n\n  if(!found) authStore.push(session);\n}\n\n/**\n * Re authenticate pool\n * @method\n * @param {{Server}|{ReplSet}|{Mongos}} server Topology the authentication method is being called on\n * @param {Pool} pool Connection pool for this topology\n * @param {authResultCallback} callback The callback to return the result from the authentication\n * @return {object}\n */\nX509.prototype.reauthenticate = function(server, pool, callback) {\n  var count = this.authStore.length;\n  if(count == 0) return callback(null, null);\n  // Iterate over all the auth details stored\n  for(var i = 0; i < this.authStore.length; i++) {\n    this.auth(server, pool, this.authStore[i].db, this.authStore[i].username, this.authStore[i].password, function(err, r) {\n      count = count - 1;\n      // Done re-authenticating\n      if(count == 0) {\n        callback(null, null);\n      }\n    });\n  }\n}\n\n/**\n * This is a result from a authentication strategy\n *\n * @callback authResultCallback\n * @param {error} error An error object. Set to null if no error present\n * @param {boolean} result The result of the authentication process\n */\n\nmodule.exports = X509;"}