{"8":[6,9,6,18],"9":[1,20,1,27],"10":[24,9,24,28],"16":[24,9,24,28],"17":[1,28,1,32],"18":[40,9,40,28],"24":[26,9,26,19],"25":[1,20,1,33],"26":[43,9,43,25],"32":[35,9,35,19],"33":[1,20,1,33],"34":[45,13,45,17],"40":[40,9,40,28],"41":[1,20,1,33],"42":[46,29,46,127],"48":[45,13,45,17],"49":[2,26,2,38],"50":[74,9,74,23],"56":[43,9,43,25],"57":[2,26,2,45],"58":[79,9,79,21],"64":[52,9,52,11],"65":[2,26,2,45],"66":[79,9,79,37],"72":[74,9,74,23],"73":[2,26,2,45],"74":[94,9,94,23],"80":[79,9,79,37],"81":[3,16,3,23],"82":[98,9,98,21],"88":[88,9,88,14],"89":[3,24,3,46],"90":[98,9,98,37],"96":[94,9,94,23],"97":[3,16,3,47],"98":[110,9,110,21],"104":[98,9,98,37],"105":[3,16,3,49],"106":[110,9,110,37],"112":[111,16,111,101],"113":[3,16,3,49],"114":[111,16,111,50],"120":[110,9,110,37],"121":[3,16,3,49],"122":[111,54,111,101],"128":[116,9,116,31],"129":[4,23,4,30],"130":[120,9,120,16],"136":[120,9,120,16],"137":[4,31,4,52],"138":[128,9,128,27],"144":[122,12,122,27],"145":[4,23,4,53],"146":[130,13,130,29],"152":[130,13,130,29],"153":[4,23,4,53],"154":[138,13,138,36],"160":[133,16,133,31],"161":[4,23,4,53],"162":[142,19,142,42],"168":[138,13,138,36],"169":[6,9,6,18],"170":[142,19,142,49],"176":[128,9,128,27],"177":[7,9,7,13],"184":[142,12,142,16],"185":[7,30,7,39],"193":[7,9,7,39],"201":[7,9,7,40],"209":[8,9,8,13],"217":[8,25,8,34],"225":[8,25,8,42],"233":[8,9,8,42],"241":[8,9,8,43],"249":[10,9,10,13],"257":[10,30,10,39],"265":[10,9,10,39],"273":[10,9,10,40],"281":[11,9,11,13],"289":[11,25,11,34],"297":[11,9,11,34],"305":[11,9,11,35],"313":[13,5,13,9],"321":[13,20,13,25],"329":[13,5,13,25],"337":[13,5,13,26],"345":[14,5,14,13],"353":[14,19,14,23],"361":[14,25,14,28],"369":[14,30,14,36],"377":[14,38,14,44],"385":[14,5,14,45],"387":[14,5,14,18],"393":[14,5,14,46],"401":[15,16,15,20],"409":[15,16,15,20],"417":[15,16,15,20],"425":[16,5,16,9],"433":[16,13,16,20],"441":[17,9,17,13],"449":[17,22,17,25],"457":[17,9,17,25],"465":[17,9,17,26],"473":[16,22,18,6],"481":[16,22,18,6],"489":[16,22,18,6],"497":[16,22,18,6],"505":[16,5,18,7],"507":[16,5,16,12],"513":[16,5,18,8],"521":[5,1,19,2],"529":[5,1,19,2],"537":[5,1,19,2],"545":[5,1,19,2],"553":[5,1,19,2],"561":[5,1,19,2],"569":[5,1,19,2],"577":[5,1,19,2],"585":[20,1,20,17],"593":[20,30,20,36],"601":[20,44,20,52],"609":[20,44,20,62],"617":[20,30,20,63],"619":[20,30,20,43],"625":[20,1,20,63],"633":[20,1,20,64],"641":[21,1,21,17],"649":[21,1,21,27],"657":[21,42,21,58],"665":[21,1,21,58],"673":[21,1,21,59],"681":[22,1,22,17],"689":[22,1,22,27],"697":[23,5,23,9],"705":[23,5,23,13],"713":[23,5,23,25],"721":[23,33,23,37],"729":[23,5,23,38],"731":[23,5,23,32],"737":[23,5,23,39],"745":[24,10,24,14],"753":[24,10,24,28],"761":[25,9,25,16],"769":[25,9,25,16],"777":[26,9,26,13],"785":[26,9,26,19],"793":[27,9,27,13],"801":[27,9,27,27],"809":[27,9,27,43],"811":[27,9,27,41],"817":[27,9,27,44],"825":[29,9,29,13],"833":[29,9,29,27],"841":[29,42,29,46],"849":[29,48,29,52],"857":[29,9,29,53],"859":[29,9,29,41],"865":[29,9,29,54],"873":[22,43,31,2],"881":[22,43,31,2],"889":[22,43,31,2],"897":[22,43,31,2],"905":[22,1,31,2],"913":[22,1,31,3],"921":[32,1,32,17],"929":[32,1,32,27],"937":[33,19,33,34],"945":[33,19,33,40],"947":[33,19,33,38],"953":[33,19,33,40],"961":[33,19,33,40],"969":[34,16,34,23],"977":[35,9,35,11],"985":[35,15,35,17],"993":[35,15,35,19],"1001":[35,9,35,20],"1009":[36,9,36,16],"1017":[36,9,36,18],"1025":[36,9,36,19],"1033":[34,28,37,6],"1041":[34,28,37,6],"1049":[34,28,37,6],"1057":[34,28,37,6],"1065":[34,12,37,7],"1067":[34,16,34,27],"1073":[34,12,37,7],"1081":[34,5,37,8],"1089":[32,35,38,2],"1097":[32,35,38,2],"1105":[32,35,38,2],"1113":[32,35,38,2],"1121":[32,35,38,2],"1129":[32,1,38,2],"1137":[32,1,38,3],"1145":[39,1,39,17],"1153":[39,1,39,27],"1161":[40,10,40,14],"1169":[40,10,40,28],"1177":[41,16,41,20],"1185":[41,16,41,20],"1193":[41,9,41,21],"1201":[43,10,43,14],"1209":[43,10,43,25],"1217":[44,15,44,19],"1225":[44,15,44,24],"1233":[44,15,44,28],"1241":[44,15,44,28],"1249":[44,9,44,29],"1257":[45,14,45,17],"1265":[46,23,46,28],"1273":[46,29,46,73],"1281":[46,76,46,127],"1289":[46,19,46,128],"1297":[46,19,46,128],"1305":[46,13,46,129],"1313":[48,9,48,13],"1321":[48,9,48,27],"1329":[48,40,48,43],"1337":[48,33,48,45],"1345":[48,9,48,46],"1347":[48,9,48,32],"1353":[48,9,48,47],"1361":[49,9,49,13],"1369":[49,27,49,31],"1377":[49,9,49,31],"1385":[49,9,49,32],"1393":[50,9,50,31],"1401":[50,32,50,36],"1409":[50,9,50,37],"1417":[50,9,50,38],"1425":[52,9,52,11],"1433":[53,9,53,11],"1441":[53,12,53,16],"1449":[53,9,53,17],"1457":[53,9,53,18],"1465":[54,12,54,16],"1473":[54,12,54,16],"1481":[54,5,54,17],"1489":[39,37,55,2],"1497":[39,37,55,2],"1505":[39,37,55,2],"1513":[39,37,55,2],"1521":[39,37,55,2],"1529":[39,1,55,2],"1537":[39,1,55,3],"1545":[57,17,57,20],"1553":[57,17,57,36],"1555":[57,17,57,34],"1561":[57,17,57,36],"1569":[57,17,57,36],"1577":[58,5,58,10],"1585":[58,14,58,20],"1593":[58,22,58,32],"1601":[58,5,58,33],"1603":[58,5,58,13],"1609":[58,5,58,34],"1617":[59,5,59,10],"1625":[59,14,59,22],"1633":[59,24,59,34],"1641":[59,5,59,35],"1643":[59,5,59,13],"1649":[59,5,59,36],"1657":[61,9,61,14],"1665":[61,30,61,36],"1673":[61,38,61,48],"1681":[61,9,61,49],"1683":[61,9,61,29],"1689":[61,9,61,50],"1697":[62,9,62,14],"1705":[62,30,62,38],"1713":[62,40,62,50],"1721":[62,9,62,51],"1723":[62,9,62,29],"1729":[62,9,62,52],"1737":[63,9,63,12],"1745":[63,18,63,26],"1753":[63,28,63,31],"1761":[63,9,63,32],"1763":[63,9,63,17],"1769":[63,9,63,33],"1777":[64,36,64,40],"1785":[64,36,64,40],"1793":[64,23,64,40],"1801":[64,17,64,40],"1809":[64,9,64,41],"1817":[60,5,65,6],"1825":[60,5,65,6],"1833":[56,1,66,2],"1841":[56,1,66,2],"1849":[56,1,66,2],"1857":[56,1,66,2],"1865":[60,5,65,6],"1873":[56,1,66,2],"1881":[67,1,67,17],"1889":[67,1,67,27],"1897":[68,15,68,20],"1905":[68,21,68,79],"1913":[68,11,68,80],"1921":[68,11,68,80],"1929":[68,5,68,81],"1937":[67,37,69,2],"1945":[67,37,69,2],"1953":[67,37,69,2],"1961":[67,1,69,2],"1969":[67,1,69,3],"1977":[70,1,70,17],"1985":[70,1,70,27],"1993":[71,12,71,16],"2001":[71,12,71,27],"2003":[71,12,71,25],"2009":[71,12,71,27],"2017":[71,5,71,28],"2025":[70,38,72,2],"2033":[70,38,72,2],"2041":[70,38,72,2],"2049":[70,1,72,2],"2057":[70,1,72,3],"2065":[73,1,73,17],"2073":[73,1,73,27],"2081":[74,10,74,14],"2089":[74,10,74,23],"2097":[75,19,75,92],"2105":[75,19,75,92],"2113":[75,19,75,92],"2121":[76,19,76,24],"2129":[76,25,76,28],"2137":[76,15,76,29],"2145":[76,15,76,29],"2153":[76,9,76,30],"2161":[78,17,78,21],"2169":[78,17,78,29],"2177":[78,17,78,29],"2185":[78,17,78,29],"2193":[79,16,79,21],"2201":[79,26,79,37],"2209":[80,26,80,30],"2217":[80,26,80,44],"2225":[80,26,80,50],"2233":[80,26,80,50],"2241":[80,26,80,50],"2249":[82,13,82,23],"2257":[83,13,83,18],"2265":[84,13,84,17],"2273":[81,24,85,10],"2281":[85,16,85,19],"2289":[81,24,85,20],"2291":[81,24,85,15],"2297":[81,24,85,20],"2305":[81,24,85,20],"2313":[86,9,86,13],"2321":[86,9,86,22],"2329":[86,34,86,42],"2337":[86,44,86,47],"2345":[86,49,86,52],"2353":[86,9,86,53],"2355":[86,9,86,33],"2361":[86,9,86,54],"2369":[88,9,88,14],"2377":[89,9,89,13],"2385":[89,9,89,17],"2393":[89,36,89,40],"2401":[89,36,89,56],"2403":[89,36,89,54],"2409":[89,36,89,60],"2417":[89,36,89,76],"2425":[89,9,89,76],"2433":[89,9,89,77],"2441":[91,12,91,16],"2449":[91,12,91,16],"2457":[91,5,91,17],"2465":[73,41,92,2],"2473":[73,41,92,2],"2481":[73,41,92,2],"2489":[73,41,92,2],"2497":[73,41,92,2],"2505":[73,41,92,2],"2513":[73,41,92,2],"2521":[73,41,92,2],"2529":[73,41,92,2],"2537":[73,41,92,2],"2545":[73,41,92,2],"2553":[73,1,92,2],"2561":[73,1,92,3],"2569":[93,1,93,17],"2577":[93,1,93,27],"2585":[94,10,94,14],"2593":[94,10,94,23],"2601":[95,9,95,16],"2609":[95,9,95,16],"2617":[97,17,97,21],"2625":[97,17,97,29],"2633":[97,17,97,29],"2641":[97,17,97,29],"2649":[98,16,98,21],"2657":[98,26,98,37],"2665":[99,26,99,30],"2673":[99,26,99,44],"2681":[99,26,99,50],"2689":[99,26,99,50],"2697":[99,26,99,50],"2705":[101,13,101,23],"2713":[102,13,102,18],"2721":[103,13,103,17],"2729":[100,24,104,10],"2737":[104,16,104,19],"2745":[100,24,104,20],"2747":[100,24,104,15],"2753":[100,24,104,20],"2761":[100,24,104,20],"2769":[105,9,105,13],"2777":[105,9,105,22],"2785":[105,34,105,42],"2793":[105,9,105,43],"2795":[105,9,105,33],"2801":[105,9,105,44],"2809":[93,41,107,2],"2817":[93,41,107,2],"2825":[93,41,107,2],"2833":[93,41,107,2],"2841":[93,41,107,2],"2849":[93,41,107,2],"2857":[93,41,107,2],"2865":[93,1,107,2],"2873":[93,1,107,3],"2881":[108,1,108,17],"2889":[108,1,108,27],"2897":[109,17,109,21],"2905":[109,17,109,29],"2913":[109,17,109,29],"2921":[109,17,109,29],"2929":[110,16,110,21],"2937":[110,26,110,37],"2945":[111,17,111,21],"2953":[111,17,111,30],"2961":[111,17,111,34],"2969":[111,17,111,50],"2977":[111,55,111,59],"2985":[111,55,111,68],"2993":[111,55,111,72],"3001":[111,55,111,88],"3009":[111,55,111,95],"3017":[111,96,111,100],"3025":[111,55,111,101],"3033":[111,16,111,101],"3041":[111,9,111,102],"3049":[113,12,113,16],"3057":[113,12,113,16],"3065":[113,5,113,17],"3073":[108,39,114,2],"3081":[108,39,114,2],"3089":[108,39,114,2],"3097":[108,39,114,2],"3105":[108,39,114,2],"3113":[108,1,114,2],"3121":[108,1,114,3],"3129":[115,1,115,17],"3137":[115,1,115,27],"3145":[116,9,116,13],"3153":[116,9,116,17],"3161":[116,9,116,31],"3169":[117,16,117,20],"3177":[117,16,117,24],"3185":[117,16,117,38],"3193":[117,16,117,38],"3201":[117,9,117,39],"3209":[119,18,119,22],"3217":[119,18,119,31],"3225":[119,18,119,31],"3233":[119,18,119,31],"3241":[120,10,120,16],"3249":[121,16,121,20],"3257":[121,16,121,20],"3265":[121,9,121,21],"3273":[122,12,122,18],"3281":[122,12,122,27],"3289":[123,18,123,24],"3297":[123,18,123,33],"3305":[123,18,123,33],"3313":[123,9,123,34],"3321":[125,12,125,16],"3329":[125,12,125,20],"3337":[125,37,125,43],"3345":[125,12,125,43],"3353":[125,12,125,43],"3361":[125,5,125,44],"3369":[115,44,126,2],"3377":[115,44,126,2],"3385":[115,44,126,2],"3393":[115,44,126,2],"3401":[115,1,126,2],"3409":[115,1,126,3],"3417":[127,1,127,17],"3425":[127,1,127,27],"3433":[128,10,128,14],"3441":[128,10,128,18],"3449":[128,10,128,27],"3457":[129,22,129,26],"3465":[129,22,129,26],"3473":[129,22,129,26],"3481":[130,14,130,20],"3489":[130,14,130,29],"3497":[131,20,131,24],"3505":[131,20,131,24],"3513":[131,13,131,25],"3521":[132,21,132,23],"3529":[132,21,132,23],"3537":[132,21,132,23],"3545":[133,16,133,22],"3553":[133,16,133,31],"3561":[134,13,134,18],"3569":[134,27,134,33],"3577":[134,27,134,47],"3585":[134,27,134,53],"3593":[134,13,134,54],"3595":[134,13,134,26],"3601":[134,13,134,55],"3609":[135,22,135,28],"3617":[135,22,135,37],"3625":[135,22,135,37],"3633":[135,13,135,38],"3641":[137,9,137,13],"3649":[137,9,137,17],"3657":[137,29,137,34],"3665":[137,40,137,43],"3673":[137,29,137,44],"3675":[137,29,137,39],"3681":[137,9,137,44],"3689":[137,9,137,45],"3697":[138,14,138,18],"3705":[138,14,138,22],"3713":[138,14,138,36],"3721":[139,13,139,17],"3729":[139,13,139,21],"3737":[139,38,139,44],"3745":[139,13,139,44],"3753":[139,13,139,45],"3761":[142,12,142,16],"3769":[142,19,142,23],"3777":[142,19,142,27],"3785":[142,19,142,36],"3793":[142,39,142,42],"3801":[142,45,142,49],"3809":[142,52,142,56],"3817":[142,52,142,60],"3825":[142,52,142,69],"3833":[142,12,142,69],"3841":[142,5,142,70],"3849":[127,42,143,2],"3857":[127,42,143,2],"3865":[127,42,143,2],"3873":[127,42,143,2],"3881":[127,42,143,2],"3889":[127,42,143,2],"3897":[127,1,143,2],"3905":[127,1,143,3],"3913":[144,1,144,17],"3921":[144,1,144,27],"3929":[145,12,145,16],"3937":[145,12,145,25],"3945":[145,12,145,25],"3953":[145,5,145,26],"3961":[144,37,146,2],"3969":[144,37,146,2],"3977":[144,37,146,2],"3985":[144,1,146,2],"3993":[144,1,146,3],"4001":[147,1,147,17],"4009":[147,1,147,27],"4017":[148,12,148,16],"4025":[148,12,148,30],"4033":[148,12,148,30],"4041":[148,5,148,31],"4049":[147,42,149,2],"4057":[147,42,149,2],"4065":[147,42,149,2],"4073":[147,1,149,2],"4081":[147,1,149,3],"4089":[150,1,150,7],"4097":[150,18,150,34],"4105":[150,1,150,34],"4113":[150,1,150,35],"4121":[1,1,150,35],"4129":[1,1,150,35],"4137":[1,1,150,35],"4145":[1,1,150,35],"4153":[1,1,150,35],"4161":[5,1,19,2],"4169":[1,1,150,35],"4177":[56,1,66,2],"4185":[1,1,150,35],"4193":[6,5,12,6],"4201":[16,22,18,6],"4209":[16,22,18,6],"4217":[5,1,19,2],"4225":[5,1,19,2],"4233":[24,5,25,16],"4241":[26,5,30,6],"4249":[22,43,31,2],"4257":[22,43,31,2],"4265":[34,28,37,6],"4273":[34,28,37,6],"4281":[32,35,38,2],"4289":[32,35,38,2],"4297":[40,5,41,21],"4305":[45,9,47,10],"4313":[43,5,51,6],"4321":[52,5,53,18],"4329":[39,37,55,2],"4337":[39,37,55,2],"4345":[60,5,65,6],"4353":[60,5,65,6],"4361":[56,1,66,2],"4369":[56,1,66,2],"4377":[67,37,69,2],"4385":[67,37,69,2],"4393":[70,38,72,2],"4401":[70,38,72,2],"4409":[74,5,77,6],"4417":[79,5,87,6],"4425":[88,5,90,6],"4433":[73,41,92,2],"4441":[73,41,92,2],"4449":[94,5,96,6],"4457":[98,5,106,6],"4465":[93,41,107,2],"4473":[93,41,107,2],"4481":[110,5,112,6],"4489":[108,39,114,2],"4497":[108,39,114,2],"4505":[116,5,118,6],"4513":[120,5,121,21],"4521":[122,5,124,6],"4529":[115,44,126,2],"4537":[115,44,126,2],"4545":[130,9,131,25],"4553":[133,9,136,10],"4561":[138,9,140,10],"4569":[128,5,141,6],"4577":[142,12,142,69],"4585":[127,42,143,2],"4593":[127,42,143,2],"4601":[144,37,146,2],"4609":[144,37,146,2],"4617":[147,42,149,2],"4625":[147,42,149,2],"4633":[1,1,150,35],"4641":[1,1,150,35],"nBranches":46,"originalCodeFileName":"/home/blake/ExpoSE/Targets/node-flarum/node_modules/mongoose/lib/types/embedded.js","instrumentedCodeFileName":"/home/blake/ExpoSE/Targets/node-flarum/node_modules/mongoose/lib/types/embedded_jalangi_.js","code":"/* eslint no-func-assign: 1 */\n\n/*!\n * Module dependencies.\n */\n\nvar Document = require('../document_provider')();\nvar PromiseProvider = require('../promise_provider');\n\n/**\n * EmbeddedDocument constructor.\n *\n * @param {Object} obj js object returned from the db\n * @param {MongooseDocumentArray} parentArr the parent array of this document\n * @param {Boolean} skipId\n * @inherits Document\n * @api private\n */\n\nfunction EmbeddedDocument(obj, parentArr, skipId, fields, index) {\n  if (parentArr) {\n    this.__parentArray = parentArr;\n    this.__parent = parentArr._parent;\n  } else {\n    this.__parentArray = undefined;\n    this.__parent = undefined;\n  }\n  this.__index = index;\n\n  Document.call(this, obj, fields, skipId);\n\n  var self = this;\n  this.on('isNew', function(val) {\n    self.isNew = val;\n  });\n}\n\n/*!\n * Inherit from Document\n */\nEmbeddedDocument.prototype = Object.create( Document.prototype );\nEmbeddedDocument.prototype.constructor = EmbeddedDocument;\n\n/**\n * Marks the embedded doc modified.\n *\n * ####Example:\n *\n *     var doc = blogpost.comments.id(hexstring);\n *     doc.mixed.type = 'changed';\n *     doc.markModified('mixed.type');\n *\n * @param {String} path the path which changed\n * @api public\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.markModified = function(path) {\n  this.$__.activePaths.modify(path);\n  if (!this.__parentArray) return;\n\n  if (this.isNew) {\n    // Mark the WHOLE parent array as modified\n    // if this is a new document (i.e., we are initializing\n    // a document),\n    this.__parentArray._markModified();\n  } else {\n    this.__parentArray._markModified(this, path);\n  }\n};\n\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nEmbeddedDocument.prototype.save = function(fn) {\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve) {\n    fn && fn();\n    resolve();\n  });\n};\n\n/**\n * Removes the subdocument from its parent array.\n *\n * @param {Function} [fn]\n * @api public\n */\n\nEmbeddedDocument.prototype.remove = function(fn) {\n  if (!this.__parentArray) return this;\n\n  var _id;\n  if (!this.willRemove) {\n    _id = this._doc._id;\n    if (!_id) {\n      throw new Error('For your own good, Mongoose does not know ' +\n                      'how to remove an EmbeddedDocument that has no _id');\n    }\n    this.__parentArray.pull({ _id: _id });\n    this.willRemove = true;\n    registerRemoveListener(this);\n  }\n\n  if (fn)\n    fn(null);\n\n  return this;\n};\n\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  var owner = sub.ownerDocument();\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    owner = sub = emitRemove = null;\n  }\n}\n\n/**\n * Override #update method of parent documents.\n * @api private\n */\n\nEmbeddedDocument.prototype.update = function() {\n  throw new Error('The #update method is not available on EmbeddedDocuments');\n};\n\n/**\n * Helper for console.log\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.inspect = function() {\n  return this.toObject();\n};\n\n/**\n * Marks a path as invalid, causing validation to fail.\n *\n * @param {String} path the field to invalidate\n * @param {String|Error} err error which states the reason `path` was invalid\n * @return {Boolean}\n * @api public\n */\n\nEmbeddedDocument.prototype.invalidate = function(path, err, val, first) {\n  if (!this.__parent) {\n    var msg = 'Unable to invalidate a subdocument that has not been added to an array.';\n    throw new Error(msg);\n  }\n\n  var index = this.__index;\n  if (typeof index !== 'undefined') {\n    var parentPath = this.__parentArray._path;\n    var fullPath = [parentPath, index, path].join('.');\n    this.__parent.invalidate(fullPath, err, val);\n  }\n\n  if (first) {\n    this.$__.validationError = this.ownerDocument().$__.validationError;\n  }\n\n  return true;\n};\n\n/**\n * Marks a path as valid, removing existing validation errors.\n *\n * @param {String} path the field to mark as valid\n * @api private\n * @method $markValid\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$markValid = function(path) {\n  if (!this.__parent) {\n    return;\n  }\n\n  var index = this.__index;\n  if (typeof index !== 'undefined') {\n    var parentPath = this.__parentArray._path;\n    var fullPath = [parentPath, index, path].join('.');\n    this.__parent.$markValid(fullPath);\n  }\n};\n\n/**\n * Checks if a path is invalid\n *\n * @param {String} path the field to check\n * @api private\n * @method $isValid\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$isValid = function(path) {\n  var index = this.__index;\n  if (typeof index !== 'undefined') {\n\n    return !this.__parent.$__.validationError ||\n      !this.__parent.$__.validationError.errors[path];\n  }\n\n  return true;\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nEmbeddedDocument.prototype.ownerDocument = function() {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  var parent = this.__parent;\n  if (!parent) return this;\n\n  while (parent.__parent) {\n    parent = parent.__parent;\n  }\n\n  return this.$__.ownerDocument = parent;\n};\n\n/**\n * Returns the full path to this document. If optional `path` is passed, it is appended to the full path.\n *\n * @param {String} [path]\n * @return {String}\n * @api private\n * @method $__fullPath\n * @memberOf EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$__fullPath = function(path) {\n  if (!this.$__.fullPath) {\n    var parent = this;\n    if (!parent.__parent) return path;\n\n    var paths = [];\n    while (parent.__parent) {\n      paths.unshift(parent.__parentArray._path);\n      parent = parent.__parent;\n    }\n\n    this.$__.fullPath = paths.join('.');\n\n    if (!this.$__.ownerDocument) {\n      // optimization\n      this.$__.ownerDocument = parent;\n    }\n  }\n\n  return path\n    ? this.$__.fullPath + '.' + path\n    : this.$__.fullPath;\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.parent = function() {\n  return this.__parent;\n};\n\n/**\n * Returns this sub-documents parent array.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.parentArray = function() {\n  return this.__parentArray;\n};\n\n/*!\n * Module exports.\n */\n\nmodule.exports = EmbeddedDocument;\n"}